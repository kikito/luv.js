<!doctype html>
<html><head><meta charset="utf-8" /><title>Collisions</title></head>
<body>
<script src="../luv.js"></script>
<script>

// This Luv.js example shows collisions in action.
var luv = Luv({fullWindow: true});

var A = luv.collider.MAABB(-100,-200,100,150),
    B = luv.collider.MAABB(200,300,50,50);
var mode = 0;

var drawAABB = function(aabb, r,g,b) {
  luv.graphics.setColor(r,g,b);
  luv.graphics.strokeRectangle(aabb.l, aabb.t, aabb.w, aabb.h)
};

var drawMAABB = function(maabb, r,g,b) {
  var c = maabb.current, p = maabb.previous;

  luv.graphics.setAlpha(0.5);
  drawAABB(c, r,g,b);

  luv.graphics.setAlpha(1);
  drawAABB(p, r,g,b);
  luv.graphics.line(p.x, p.y, c.x, c.y);
};

luv.draw = function() {
  var d = luv.graphics.getDimensions();
  luv.graphics.translate(d.width/2, d.height/2);
  drawMAABB(A, 255, 0, 0);
  drawMAABB(B, 0, 255, 0);

  var m = A.current.getMinkowskyDiff(B.current);
  drawAABB(m, 255, 255, 0);

  var d = A.getRelativeDisplacement(B);
  luv.graphics.line(0,0, d.x, d.y);

  var obj = m.getSegmentIntersection(0,0, d.x, d.y);
  if(obj) {
    luv.graphics.strokeCircle(obj.x0, obj.y0, 5);
    luv.graphics.fillCircle(obj.x1, obj.y1, 5);
  }
};

luv.update = function(dt) {
  var d = luv.graphics.getDimensions(),
      m = luv.mouse.getPosition(),
      c;

  m.x -= d.width / 2;
  m.y -= d.height / 2;

  switch(mode) {
    case 0:
      c = A.current;
      A.update(m.x - c.w2, m.y - c.h2, c.w, c.h)
      break;
    case 1:
      c = A.current;
      A.adjust(m.x - c.w2, m.y - c.h2, c.w, c.h)
      break;
    case 2:
      c = B.current;
      B.update(m.x - c.w2, m.y - c.h2, c.w, c.h)
      break;
    case 3:
      c = B.current;
      B.adjust(m.x - c.w2, m.y - c.h2, c.w, c.h)
      break;
    }
};

luv.mouse.onPressed = function() {
  mode = (mode + 1) % 4;
}

// luv.run must be invoked, otherwise the game will not start
luv.run();
</script>
</body>
</html>
