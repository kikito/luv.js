<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Luv.js example viewer and tester</title>
  <link rel="stylesheet"  href="css/normalize.css" />
  <link rel="stylesheet"  href="css/style.css" />
</head>
<body>

  <div class="page">
    <div class="row">
      <div class="sidebar column">
        <ul id="example-selectors" class="plain-list">
        </ul>
      </div>
      <div class="main column">
        <div class="row">
          <div class="code column">
            <form action="#">
              <textarea id="textarea"></textarea>
            </form>
          </div>
          <div class="iframe column">
            <iframe id="iframe">
            </iframe>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="examples.js"></script>
  <script>
    (function() {

      var $textArea = document.getElementById('textarea'),
          $iframe   = document.getElementById('iframe');

      var refreshIframe = function() {
        var $parent   = $iframe.parentNode,
            $newframe = document.createElement('iframe');

        $parent.removeChild($iframe);
        $parent.appendChild($newframe);

        // settimeout gives the new frame time to "settle in" in the dom
        // without it, sometimes it doesn't refresh correctly
        setTimeout(function() {
          var doc  = $newframe.contentWindow.document;
          doc.open();
          doc.write($textArea.value);
          doc.close();

          $iframe = $newframe;
        }, 1);
      };

      var refreshInputTimeout;
      var delayedRefreshIframe = function() {
        clearTimeout(refreshInputTimeout);
        refreshInputTimeout = setTimeout(refreshIframe, 1000);
      };

      var addExampleToList = function(example) {
        var $ul = document.getElementById('example-selectors'),
            $li = document.createElement('li'),
            $a  = document.createElement('a');

        $a.href = "#" + example.id;
        $a.innerHTML = example.name;
        $a.addEventListener('click', function(evt) {
          evt.preventDefault();
          evt.stopPropagation();

          $textArea.value = example.html;
          refreshIframe();

          return false;
        });

        $li.appendChild($a);
        $ul.appendChild($li);
      };



      var getAnchor = function() {
        var split = location.href.split("#");
        return split.length > 1 ? split[split.length - 1] : "";
      }

      document.addEventListener('DOMContentLoaded', function() {
        var anchor   = getAnchor(),
            isFilled = false;

        $textArea.focus();
        $textArea.addEventListener('input', delayedRefreshIframe);

        examples.forEach(function(example) {
          addExampleToList(example);

          // if we have an anchor, use it to fill the example
          if(example.id == anchor) {
            isFilled = true;
            $textArea.value = example.html;
            refreshIframe();
          }
        });

        // if we have no anchor, just fill it with the first example
        if(!isFilled) {
          $textArea.value = examples[0].html;
          refreshIframe();
        }
      });
    }());


  </script>

</body>
</html>

