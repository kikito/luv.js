/*! luv 0.0.1 (2013-03-20) - https://github.com/kikito/luv.js */
/*! Minimal HTML5 game development lib */
/*! Enrique Garcia Cota */
(function(){window.performance=window.performance||{},performance.now=performance.now||performance.webkitNow||performance.msNow||performance.mozNow||Date.now})(),function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;e.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=performance.now,i=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+i)},i);return t=n+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(){var t=function(t){for(var e,n=1;arguments.length>n;n++){e=arguments[n];for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}return t},e=function(t,e){e=Array.isArray(e)?e:[e];for(var n=0;e.length>n;n++)delete t[e[n]];return t},n=Object.create,i=t(n(null),{toString:function(){return"instance of "+this.getClass().getName()}}),o=t(function(){return n(i)},{init:function(){},getName:function(){return"Base"},toString:function(){return"Base"},getSuper:function(){return null},methods:i,include:function(){return t.apply(this,[this.methods].concat(Array.prototype.slice.call(arguments,0)))},subclass:function(i,o){o=o||{};var r=this,s=function(){return i},u=e(t(n(r.methods),o),"init"),a=t(function(){var t=n(u);return a.init.apply(t,arguments),t},r,o,{getName:s,toString:s,getSuper:function(){return r},methods:u});return u.getClass=function(){return a},a}});i.getClass=function(){return o},Luv=o.subclass("Luv",{init:function(t){if(t=r(t),this.el=t.el,t.load&&(this.load=t.load),t.update&&(this.update=t.update),t.draw&&(this.draw=t.draw),t.run&&(this.run=t.run),t.onResize&&(this.onResize=t.onResize),this.media=Luv.Media(),this.timer=Luv.Timer(),this.keyboard=Luv.Keyboard(this.el),this.mouse=Luv.Mouse(this.el),this.audio=Luv.Audio(this.media),this.graphics=Luv.Graphics(this.el,this.media),t.fullWindow){var e=function(){this.graphics.setDimensions(window.innerWidth,window.innerHeight),this.onResize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e,!1),window.addEventListener("orientationChange",e,!1)}},load:function(){},draw:function(){},update:function(){},run:function(){var t=this;t.load();var e=function(){t.timer.step();var n=t.timer.getDeltaTime();t.update(n),t.graphics.setCanvas(),t.graphics.clear(),t.draw(),t.timer.nextFrame(e)};t.timer.nextFrame(e)},onResize:function(){}}),Luv.Class=function(t,e){return o.subclass(t,e)};var r=function(t){t=t||{};var e=t.el,n=t.id,i=t.width,o=t.height,r=document.getElementsByTagName("body")[0],s=document.getElementsByTagName("html")[0],u="width: 100%; height: 100%; margin: 0; overflow: hidden;";return!e&&n&&(e=document.getElementById(n)),e?(!i&&e.getAttribute("width")&&(i=parseInt(e.getAttribute("width"),10)),!o&&e.getAttribute("height")&&(o=parseInt(e.getAttribute("height"),10))):(e=document.createElement("canvas"),r.appendChild(e)),t.fullWindow?(s.style.cssText=r.style.cssText=u,i=window.innerWidth,o=window.innerHeight):(i=i||800,o=o||600),e.setAttribute("width",i),e.setAttribute("height",o),t.el=e,t.width=i,t.height=o,t}}(),function(){Luv.Timer=Luv.Class("Luv.Timer",{init:function(){this.microTime=performance.now(),this.deltaTime=0,this.deltaTimeLimit=Luv.Timer.DEFAULT_DELTA_TIME_LIMIT},step:function(){this.update((performance.now()-this.microTime)/1e3)},update:function(t){this.deltaTime=Math.max(0,Math.min(this.deltaTimeLimit,t)),this.microTime+=1e3*t},setDeltaTimeLimit:function(t){this.deltaTimeLimit=t},getDeltaTimeLimit:function(){return this.deltaTimeLimit},getDeltaTime:function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},getFPS:function(){return 0===this.deltaTime?0:1/this.deltaTime},nextFrame:function(t){window.requestAnimationFrame(t)}}),Luv.Timer.DEFAULT_DELTA_TIME_LIMIT=.25}(),function(){Luv.Keyboard=Luv.Class("Luv.Keyboard",{init:function(t){var e=this;return e.keysDown={},e.el=t,t.tabIndex=1,t.focus(),t.addEventListener("keydown",function(t){var n=i(t);e.keysDown[n]=!0,e.onPressed(n,t.which)}),t.addEventListener("keyup",function(t){var n=i(t);e.keysDown[n]=!1,e.onReleased(n,t.which)}),e},onPressed:function(){},onReleased:function(){},isDown:function(t){return!!this.keysDown[t]}});var t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},n={16:"rshift",17:"rctrl",18:"ralt"},i=function(i){var o,r=i.which;return o=i.keyLocation&&i.keyLocation>1?n[r]:i.shiftKey?e[r]||t[r]:t[r],o||String.fromCharCode(r)}}(),function(){Luv.Mouse=Luv.Class("Luv.Mouse",{init:function(t){var i=this;i.x=0,i.y=0,i.pressedButtons={},i.wheelTimeOuts={};var o=function(t){i.pressedButtons[t]=!0,i.onPressed(i.x,i.y,t)},r=function(t){i.pressedButtons[t]=!1,i.onReleased(i.x,i.y,t)},s=function(t){t.preventDefault();var e=n(t);clearTimeout(i.wheelTimeOuts[e]),i.wheelTimeOuts[e]=setTimeout(function(){r(e)},20),o(e)};t.addEventListener("mousemove",function(e){var n=t.getBoundingClientRect();i.x=e.pageX-n.left,i.y=e.pageY-n.top}),t.addEventListener("mousedown",function(t){o(e(t))}),t.addEventListener("mouseup",function(t){r(e(t))}),t.addEventListener("DOMMouseScroll",s),t.addEventListener("mousewheel",s)},getX:function(){return this.x},getY:function(){return this.y},getPosition:function(){return{x:this.x,y:this.y}},onPressed:function(){},onReleased:function(){},isPressed:function(t){return!!this.pressedButtons[t]}});var t={1:"l",2:"m",3:"r"},e=function(e){return t[e.which]},n=function(t){var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));return 1===e?"wu":"wd"}}(),function(){Luv.Media=Luv.Class("Luv.Media",{init:function(){this.pending=0},isLoaded:function(){return 0===this.pending},getPending:function(){return this.pending},onAssetLoaded:function(){},onAssetError:function(t){throw Error("Could not load "+t)},onLoaded:function(){},newAsset:function(t){this.pending++,t.status="pending"},registerLoad:function(t){this.pending--,t.status="loaded",this.onAssetLoaded(t),this.isLoaded()&&this.onLoaded()},registerError:function(t){this.pending--,t.status="error",this.onAssetError(t)}}),Luv.Media.Asset={isPending:function(){return"pending"==this.status},isLoaded:function(){return"loaded"==this.status},isError:function(){return"error"==this.status}}}(),function(){Luv.Audio=Luv.Class("Luv.Audio",{init:function(t){this.media=t},isAvailable:function(){return Luv.Audio.isAvailable()},getSupportedTypes:function(){return Luv.Audio.getSupportedTypes()},canPlayType:function(t){return this.supportedTypes[t.toLowerCase()]},Sound:function(){if(this.isAvailable()){var t=[this.media].concat(Array.prototype.slice.call(arguments,0));return Luv.Audio.Sound.apply(Luv.Audio.Sound,t)}return Luv.Audio.NullSound()}}),Luv.Audio.isAvailable=function(){return n},Luv.Audio.canPlayType=function(t){return!!e[t.toLowerCase()]},Luv.Audio.getSupportedTypes=function(){return Object.keys(e)};var t=document.createElement("audio"),e={},n=!!t.canPlayType;n&&(e.ogg=!!t.canPlayType('audio/ogg; codecs="vorbis"'),e.mp3=!!t.canPlayType("audio/mpeg;"),e.wav=!!t.canPlayType('audio/wav; codecs="1"'),e.m4a=!!t.canPlayType("audio/x-m4a;"),e.aac=!!t.canPlayType("audio/aac;"))}(),function(){Luv.Audio.NullSound=Luv.Class("Luv.Audio.NullSound",{play:function(){return Luv.Audio.SoundInstance(n())}});var t={};"pause stop setVolume setVolume setLoop setSpeed setTime setExpirationTime".split(" ").forEach(function(e){t[e]=function(){}});var e={};"countInstances countPlayingInstances getExpirationTime getVolume getSpeed getTime getDuration".split(" ").forEach(function(e){t[e]=function(){return 0}}),Luv.Audio.NullSound.include(t,e);var n=function(){return{volume:1,playbackRate:1,currentTime:0,play:function(){},pause:function(){},addEventListener:function(t,e){e()}}}}(),function(){Luv.Audio.Sound=Luv.Class("Luv.Audio.Sound",{init:function(t){var e=Array.prototype.slice.call(arguments,1);if(0===e.length)throw Error("Must provide at least one path for the Sound");if(e=e.filter(i),0===e.length)throw Error("None of the provided sound types ("+e.join(", ")+") is supported by the browser: ("+Luv.Audio.getSupportedTypes().join(", ")+")");var n=this;n.path=e[0],t.newAsset(n);var o=n.el=document.createElement("audio");o.preload="auto",o.addEventListener("canplaythrough",function(){n.isLoaded()||t.registerLoad(n)}),o.addEventListener("error",function(){t.registerError(n)}),o.src=n.path,o.load(),n.instances=[],n.expirationTime=Luv.Audio.Sound.DEFAULT_EXPIRATION_TIME},toString:function(){return'Luv.Audio.Sound("'+this.path+'")'},play:function(t){if(!this.isLoaded())throw Error("Attepted to play a non loaded sound: "+this);var e=this.getReadyInstance(t);return e.play(),e},pause:function(){this.instances.forEach(function(t){t.pause()})},stop:function(){this.instances.forEach(function(t){t.stop()})},countInstances:function(){return this.instances.length},countPlayingInstances:function(){var t=0;return this.instances.forEach(function(e){t+=e.isPlaying()?1:0}),t},getReadyInstance:function(n){var i=t(this.instances);return i?i.reset(n):(i=Luv.Audio.SoundInstance(this.el.cloneNode(!0),n),this.instances.push(i)),e(this,i),i},getExpirationTime:function(){return this.expirationTime},setExpirationTime:function(t){this.expirationTime=t}}),Luv.Audio.Sound.DEFAULT_EXPIRATION_TIME=3e3,Luv.Audio.Sound.include(Luv.Media.Asset),Luv.Audio.SoundMethods={setVolume:function(t){t=o(t,0,1),this.el.volume=t},getVolume:function(){return this.el.volume},setLoop:function(t){this.loop=!!t,t?this.el.loop="loop":this.el.removeAttribute("loop")},getLoop:function(){return this.loop},setSpeed:function(t){this.el.playbackRate=t},getSpeed:function(){return this.el.playbackRate},setTime:function(t){try{this.el.currentTime=t}catch(e){}},getTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration}},Luv.Audio.Sound.include(Luv.Audio.SoundMethods);var t=function(t){for(var e,n=0;t.length>n;n++)if(e=t[n],e.isReady())return e},e=function(t,e){clearTimeout(e.expirationTimeOut),e.expirationTimeOut=setTimeout(function(){var n=t.instances.indexOf(e);-1!=n&&t.instances.splice(n,1)},t.expirationTime)},n=function(t){var e=t.match(/.+\.([^?]+)(\?|$)/);return e?e[1].toLowerCase():""},i=function(t){return Luv.Audio.canPlayType(n(t))},o=function(t,e,n){return Math.max(e,Math.min(n,Number(t)))}}(),function(){Luv.Audio.SoundInstance=Luv.Class("Luv.Audio.SoundInstance",{init:function(t,e){var n=this;n.el=t,n.el.addEventListener("ended",function(){n.stop()}),n.reset(e)},reset:function(t){t=t||{};var e=this.el,n=t.volume===void 0?e.volume:t.volume,i=t.loop===void 0?!!e.loop:t.loop,o=t.speed===void 0?e.playbackRate:t.speed,r=t.time===void 0?e.currentTime:t.time,s=t.status===void 0?"ready":t.status;this.setVolume(n),this.setLoop(i),this.setSpeed(o),this.setTime(r),this.status=s},play:function(){this.el.play(),this.status="playing"},pause:function(){this.isPlaying()&&(this.el.pause(),this.status="paused")},stop:function(){this.el.pause(),this.setTime(0),this.status="ready"},isPaused:function(){return"paused"==this.status},isReady:function(){return"ready"==this.status},isPlaying:function(){return"playing"==this.status}}),Luv.Audio.SoundInstance.include(Luv.Audio.SoundMethods)}(),function(){Luv.Graphics=Luv.Class("Luv.Graphics",{init:function(t,e){this.el=t,this.media=e,this.color={},this.backgroundColor={};var n=this.getDimensions();this.defaultCanvas=this.Canvas(n.width,n.height),this.defaultCanvas.el=t,this.setCanvas(),this.reset()},setCanvas:function(t){t=t||this.defaultCanvas,this.canvas=t,this.el=t.el,this.ctx=t.getContext(),this.reset()},getCanvas:function(){return this.canvas},setColor:function(t,n,i,o){e(this,"color",t,n,i,o)},getColor:function(){return n(this.color)},setBackgroundColor:function(t,n,i,o){e(this,"backgroundColor",t,n,i,o)},getBackgroundColor:function(){return n(this.backgroundColor)},getWidth:function(){return parseInt(this.el.getAttribute("width"),10)},getHeight:function(){return parseInt(this.el.getAttribute("height"),10)},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimensions:function(t,e){this.el.setAttribute("width",t),this.el.setAttribute("height",e)},setLineWidth:function(t){this.lineWidth=t,this.ctx.lineWidth=t},getLineWidth:function(){return this.lineWidth},setLineCap:function(t){if("butt"!=t&&"round"!=t&&"square"!=t)throw Error("Line cap must be either 'butt', 'round' or 'square' (was: "+t+")");this.ctx.lineCap=t,this.lineCap=this.ctx.lineCap},getLineCap:function(){return this.lineCap},clear:function(){this.reset(),this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.getWidth(),this.getHeight())},print:function(t,e,n){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(t,e,n)},line:function(){var t=Array.isArray(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),o(this,"luv.graphics.line",4,t),i(this,"line")},rectangle:function(t,e,n,o,r){this.ctx.beginPath(),this.ctx.rect(e,n,o,r),i(this,t),this.ctx.closePath()},polygon:function(){var t=arguments[0],e=arguments[1];if(!Array.isArray(e)){e=[];for(var n=1;arguments.length>n;n++)e[n-1]=arguments[n]}this.ctx.beginPath(),o(this,"luv.graphics.polygon",6,e),i(this,t),this.ctx.closePath()},circle:function(e,n,i,o){this.arc(e,n,i,o,0,t),this.ctx.closePath()},arc:function(t,e,n,o,r,s){this.ctx.beginPath(),this.ctx.arc(e,n,o,r,s,!1),i(this,t)},draw:function(t,e,n,i,o,s,u,a){var c=this.ctx;i=i===void 0?1:i,o=o===void 0?1:o,s=s===void 0?0:r(s),u=u===void 0?0:u,a=a===void 0?0:a,1!==i||1!==o||0!==s||0!==u||0!==a?(c.save(),c.translate(e,n),c.translate(u,a),c.rotate(s),c.scale(i,o),c.translate(-u,-a),t.draw(c,0,0),c.restore()):t.draw(c,e,n)},drawCentered:function(t,e,n,i,o,r){var s=t.getDimensions(),u=s.width/2,a=s.height/2;this.draw(t,e-u,n-a,i,o,r,u,a)},translate:function(t,e){this.ctx.translate(t,e)},scale:function(t,e){this.ctx.scale(t,e)},rotate:function(t){this.ctx.rotate(t)},reset:function(){this.ctx.setTransform(1,0,0,1,0,0),this.setColor(255,255,255),this.setBackgroundColor(0,0,0),this.setImageSmoothing(!0),this.setLineWidth(1),this.setLineCap("butt")},push:function(){this.ctx.save()},pop:function(){this.ctx.restore()},setImageSmoothing:function(t){this.imageSmoothing=t=!!t,t&&(this.ctx.webkitImageSmoothingEnabled=t,this.ctx.mozImageSmoothingEnabled=t,this.ctx.imageSmoothingEnabled=t)},getImageSmoothing:function(){return this.imageSmoothing},Canvas:function(t,e){return Luv.Graphics.Canvas(t||this.getWidth(),e||this.getHeight())},Image:function(t){return Luv.Graphics.Image(this.media,t)}});var t=2*Math.PI,e=function(t,e,n,i,o,r){var s=t[e];Array.isArray(n)?(s.r=n[0],s.g=n[1],s.b=n[2],s.a=n[3]||255):(s.r=n,s.g=i,s.b=o,s.a=r||255),t[e+"Style"]="rgba("+[s.r,s.g,s.b,s.a/255].join()+")"},n=function(t){return[t.r,t.g,t.b,t.a]},i=function(t,e){switch(e){case"fill":t.ctx.fillStyle=t.colorStyle,t.ctx.fill();break;case"line":t.ctx.strokeStyle=t.colorStyle,t.ctx.stroke();break;default:throw Error("Invalid mode: ["+e+']. Should be "fill" or "line"')}},o=function(t,e,n,i){if(n>i.length)throw Error(e+" requires at least 4 parameters");if(1==i.length%2)throw Error(e+" requires an even number of parameters");t.ctx.moveTo(i[0],i[1]);for(var o=2;i.length>o;o+=2)t.ctx.lineTo(i[o],i[o+1]);t.ctx.stroke()},r=function(e){return e%=t,e>=0?e:e+t}}(),function(){Luv.Graphics.Canvas=Luv.Class("Luv.Graphics.Canvas",{init:function(t,e){var n=document.createElement("canvas");n.setAttribute("width",t),n.setAttribute("height",e),this.el=n},getContext:function(){return this.el.getContext("2d")},getWidth:function(){return parseInt(this.el.getAttribute("width"),10)},getHeight:function(){return parseInt(this.el.getAttribute("height"),10)},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimensions:function(t,e){this.el.setAttribute("width",t),this.el.setAttribute("height",e)},draw:function(t,e,n){t.drawImage(this.el,e,n)}})}(),function(){Luv.Graphics.Image=Luv.Class("Luv.Graphics.Image",{init:function(t,e){var n=this;n.path=e,t.newAsset(n);var i=new Image;n.source=i,i.addEventListener("load",function(){t.registerLoad(n)}),i.addEventListener("error",function(){t.registerError(n)}),i.src=e},toString:function(){return'Luv.Graphics.Image("'+this.path+'")'},getWidth:function(){return this.source.width},getHeight:function(){return this.source.height},getDimensions:function(){return{width:this.source.width,height:this.source.height}},draw:function(t,e,n){if(!this.isLoaded())throw Error("Attepted to draw a non loaded image: "+this);t.drawImage(this.source,e,n)}}),Luv.Graphics.Image.include(Luv.Media.Asset)}();