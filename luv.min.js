/*! luv 0.0.1 (2013-11-10) - https://github.com/kikito/luv.js */
/*! Minimal HTML5 game development lib */
/*! Enrique Garcia Cota */
window.Luv=function(){var t=function(t){for(var i,e=1;arguments.length>e;e++){i=arguments[e];for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}return t},i=function(t,i){i=Array.isArray(i)?i:[i];for(var e=0;i.length>e;e++)delete t[i[e]];return t},e=Object.create,n={toString:function(){return"instance of "+this.getClass().getName()}},r=t(function(){return e(n)},{init:function(){},getName:function(){return"Base"},toString:function(){return"Base"},getSuper:function(){return null},methods:n,include:function(){return t.apply(this,[this.methods].concat(Array.prototype.slice.call(arguments,0)))},subclass:function(n,r){r=r||{};var o=this,s=function(){return n},u=i(t(e(o.methods),r),"init"),a=t(function(){var t=e(u);return a.init.apply(t,arguments),t},o,r,{getName:s,toString:s,getSuper:function(){return o},methods:u});return u.getClass=function(){return a},a}});n.getClass=function(){return r};var o=r.subclass("Luv",{init:function(t){t=s(t);var i=this;if(i.el=t.el,i.el.tabIndex=1,"load update draw run onResize onBlur onFocus".split(" ").forEach(function(e){t[e]&&(i[e]=t[e])}),i.media=o.Media(),i.timer=o.Timer(),i.keyboard=o.Keyboard(i.el),i.mouse=o.Mouse(i.el),i.touch=o.Touch(i.el),i.audio=o.Audio(i.media),i.graphics=o.Graphics(i.el,i.media),i.canvas=o.Graphics.Canvas(i.el),i.collider=o.Collider(),t.fullWindow){var e=function(){i.canvas.setDimensions(window.innerWidth,window.innerHeight),i.onResize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e,!1),window.addEventListener("orientationChange",e,!1),i.el.focus()}i.el.addEventListener("blur",function(){i.onBlur()}),i.el.addEventListener("focus",function(){i.onFocus()})},load:function(){},draw:function(){},update:function(){},run:function(){var t=this;t.load();var i=function(){t.timer.nativeUpdate(t.el);var e=t.timer.getDeltaTime();t.update(e),t.canvas.clear(),t.draw(),t.timer.nextFrame(i)};t.timer.nextFrame(i)},onResize:function(){},onBlur:function(){},onFocus:function(){}});o.Class=function(t,i){return r.subclass(t,i)},o.Base=r,o.extend=t;var s=function(t){t=t||{};var i=t.el,e=t.id,n=t.width,r=t.height,o=document.getElementsByTagName("body")[0],s=document.getElementsByTagName("html")[0],u="width: 100%; height: 100%; margin: 0; overflow: hidden;";return!i&&e&&(i=document.getElementById(e)),i?(!n&&i.getAttribute("width")&&(n=Number(i.getAttribute("width"))),!r&&i.getAttribute("height")&&(r=Number(i.getAttribute("height")))):(i=document.createElement("canvas"),o.appendChild(i)),t.fullWindow?(s.style.cssText=o.style.cssText=u,n=window.innerWidth,r=window.innerHeight):(n=n||800,r=r||600),i.setAttribute("width",n),i.setAttribute("height",r),t.el=i,t.width=n,t.height=r,t};return o}(),function(){Luv.Timer=Luv.Class("Luv.Timer",{init:function(){this.microTime=i.now(),this.deltaTime=0,this.deltaTimeLimit=Luv.Timer.DEFAULT_DELTA_TIME_LIMIT,this.events={},this.maxEventId=0},nativeUpdate:function(t){this.update((i.now()-this.microTime)/1e3,t)},update:function(t){this.deltaTime=Math.max(0,Math.min(this.deltaTimeLimit,t)),this.microTime+=1e3*t;for(var i in this.events)this.events.hasOwnProperty(i)&&this.events[i].update(t)&&delete this.events[i]},setDeltaTimeLimit:function(t){this.deltaTimeLimit=t},getDeltaTimeLimit:function(){return this.deltaTimeLimit},getDeltaTime:function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},getFPS:function(){return 0===this.deltaTime?0:1/this.deltaTime},nextFrame:function(t){n(t)},after:function(i,e,n){return t(this,Luv.Timer.After(i,e,n))},every:function(i,e,n){return t(this,Luv.Timer.Every(i,e,n))},tween:function(i,e,n,r){return t(this,Luv.Timer.Tween(i,e,n,r))},clear:function(t){return this.events[t]?(delete this.events[t],!0):!1}}),Luv.Timer.DEFAULT_DELTA_TIME_LIMIT=.25;var t=function(t,i){var e=t.maxEventId++;return t.events[e]=i,e},i=window.performance||Date;i.now=i.now||i.msNow||i.mozNow||i.webkitNow||Date.now;var e=0,n=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(t){var n=i.now(),r=Math.max(0,16-(n-e)),o=setTimeout(function(){t(n+r)},r);return e=n+r,o}}(),function(){Luv.Timer.After=Luv.Class("Luv.Timer.After",{init:function(t,i,e){this.timeRunning=0,this.timeToCall=t,this.callback=i,this.context=e},update:function(t){this.timeRunning+=t;var i=this.timeRunning-this.timeToCall;return i>=0?(this.callback.call(this.context,i),!0):!1}})}(),function(){Luv.Timer.Every=Luv.Class("Luv.Timer.Every",{init:function(t,i,e){this.timeRunning=0,this.timeToCall=t,this.callback=i,this.context=e},update:function(t){if(this.timeRunning+=t,this.timeToCall>0)for(;this.timeRunning>=this.timeToCall;)this.callback.call(this.context,this.timeRunning-this.timeToCall),this.timeRunning-=this.timeToCall;else this.callback.call(this.context,t);return!1}})}(),function(){Luv.Timer.Tween=Luv.Class("Luv.Timer.Tween",{init:function(t,i,e,n){U(i,e,[]),n=n||{},this.easing=q(n.easing),this.every=n.every||this.every,this.after=n.after||this.after,this.context=n.context||this,this.runningTime=0,this.finished=!1,this.timeToFinish=t,this.subject=i,this.from=Q(i,e),this.to=Q(e)},update:function(t){return this.runningTime>=this.timeToFinish?void 0:(this.runningTime+=t,this.runningTime>=this.timeToFinish&&(this.runningTime=this.timeToFinish,this.after.call(this.context),this.finished=!0),this.every.call(this.context,z(this,this.from,this.to)),this.finished)},every:function(t){this.subject=H(this.subject,t)},after:function(){},isFinished:function(){return!!this.finished}});var t=function(t,i,e,n){return e*t/n+i},i=function(t,i,e,n){return e*Math.pow(t/n,2)+i},e=function(t,i,e,n){return t/=n,-e*t*(t-2)+i},n=function(t,i,e,n){return t=2*(t/n),1>t?e/2*Math.pow(t,2)+i:-e/2*((t-1)*(t-3)-1)+i},r=function(t,n,r,o){return o/2>t?e(2*t,n,r/2,o):i(2*t-o,n+r/2,r/2,o)},o=function(t,i,e,n){return e*Math.pow(t/n,3)+i},u=function(t,i,e,n){return e*(Math.pow(t/n-1,3)+1)+i},a=function(t,i,e,n){return t=2*(t/n),1>t?e/2*t*t*t+i:(t-=2,e/2*(t*t*t+2)+i)},h=function(t,i,e,n){return n/2>t?u(2*t,i,e/2,n):o(2*t-n,i+e/2,e/2,n)},c=function(t,i,e,n){return e*Math.pow(t/n,4)+i},f=function(t,i,e,n){return-e*(Math.pow(t/n-1,4)-1)+i},l=function(t,i,e,n){return t=2*(t/n),1>t?e/2*Math.pow(t,4)+i:-e/2*(Math.pow(t-2,4)-2)+i},d=function(t,i,e,n){return n/2>t?f(2*t,i,e/2,n):c(2*t-n,i+e/2,e/2,n)},v=function(t,i,e,n){return e*Math.pow(t/n,5)+i},g=function(t,i,e,n){return e*(Math.pow(t/n-1,5)+1)+i},p=function(t,i,e,n){return t=2*(t/n),1>t?e/2*Math.pow(t,5)+i:e/2*(Math.pow(t-2,5)+2)+i},m=function(t,i,e,n){return n/2>t?g(2*t,i,e/2,n):v(2*t-n,i+e/2,e/2,n)},w=function(t,i,e,n){return-e*Math.cos(t/n*(Math.PI/2))+e+i},L=function(t,i,e,n){return e*Math.sin(t/n*(Math.PI/2))+i},y=function(t,i,e,n){return-e/2*(Math.cos(Math.PI*t/n)-1)+i},b=function(t,i,e,n){return n/2>t?L(2*t,i,e/2,n):w(2*t-n,i+e/2,e/2,n)},A=function(t,i,e,n){return 0===t?i:e*Math.pow(2,10*(t/n-1))+i-.001*e},T=function(t,i,e,n){return t==n?i+e:1.001*e*(-Math.pow(2,-10*t/n)+1)+i},x=function(t,i,e,n){return 0===t?i:t==n?i+e:(t=2*(t/n),1>t?e/2*Math.pow(2,10*(t-1))+i-5e-4*e:1.0005*(e/2)*(-Math.pow(2,-10*(t-1))+2)+i)},C=function(t,i,e,n){return n/2>t?T(2*t,i,e/2,n):A(2*t-n,i+e/2,e/2,n)},E=function(t,i,e,n){return-e*(Math.sqrt(1-Math.pow(t/n,2))-1)+i},M=function(t,i,e,n){return e*Math.sqrt(1-Math.pow(t/n-1,2))+i},S=function(t,i,e,n){return t=2*(t/n),1>t?-e/2*(Math.sqrt(1-t*t)-1)+i:(t-=2,e/2*(Math.sqrt(1-t*t)+1)+i)},I=function(t,i,e,n){return n/2>t?M(2*t,i,e/2,n):E(2*t-n,i+e/2,e/2,n)},k=function(t,i,e,n){return t=t===void 0?.3*n:t,i=i||0,Math.abs(e)>i?(i=e,s=t/4):s=t/(2*Math.PI)*Math.asin(e/i),[t,i,s]},P=function(t,i,e,n,r,o){if(0===t)return i;if(t/=n,1==t)return i+e;var s=k(o,r,e,n),u=s[2];return o=s[0],r=s[1],t-=1,-(r*Math.pow(2,10*t)*Math.sin((t*n-u)*2*Math.PI/o))+i},B=function(t,i,e,n,r,o){if(0===t)return i;if(t/=n,1==t)return i+e;var s=k(o,r,e,n),u=s[2];return o=s[0],r=s[1],r*Math.pow(2,-10*t)*Math.sin((t*n-u)*2*Math.PI/o)+e+i},O=function(t,i,e,n,r,o){if(0===t)return i;if(t/=n,1==t)return i+e;var s=k(o,r,e,n),u=s[2];return o=s[0],r=s[1],t-=1,0>t?-.5*r*Math.pow(2,10*t)*Math.sin((t*n-u)*2*Math.PI/o)+i:.5*r*Math.pow(2,-10*t)*Math.sin((t*n-u)*2*Math.PI/o)+e+i},R=function(t,i,e,n,r,o){return n/2>t?B(2*t,i,e/2,n,r,o):P(2*t-n,i+e/2,e/2,n,r,o)},D=function(t,i,e,n,r){return r=r||1.70158,t/=n,e*t*t*((r+1)*t-r)+i},N=function(t,i,e,n,r){return r=r||1.70158,t=t/n-1,e*(t*t*((r+1)*t+r)+1)+i},F=function(t,i,e,n,r){return r=1.525*(r||1.70158),t=2*(t/n),1>t?e/2*t*t*((r+1)*t-r)+i:(t-=2,e/2*(t*t*((r+1)*t+r)+2)+i)},G=function(t,i,e,n,r){return n/2>t?N(2*t,i,e/2,n,r):D(2*t-n,i+e/2,e/2,n,r)},W=function(t,i,e,n){return t/=n,1/2.75>t?e*7.5625*t*t+i:2/2.75>t?(t-=1.5/2.75,e*(7.5625*t*t+.75)+i):2.5/2.75>t?(t-=2.25/2.75,e*(7.5625*t*t+.9375)+i):(t-=2.625/2.75,e*(7.5625*t*t+.984375)+i)},_=function(t,i,e,n){return e-W(n-t,0,e,n)+i},K=function(t,i,e,n){return n/2>t?.5*_(2*t,0,e,n)+i:.5*W(2*t-n,0,e,n)+.5*e+i},j=function(t,i,e,n){return n/2>t?W(2*t,i,e/2,n):_(2*t-n,i+e/2,e/2,n)};Luv.Timer.Tween.easing={linear:t,inQuad:i,outQuad:e,inOutQuad:n,outInQuad:r,inCubic:o,outCubic:u,inOutCubic:a,outInCubic:h,inQuart:c,outQuart:f,inOutQuart:l,outInQuart:d,inQuint:v,outQuint:g,inOutQuint:p,outInQuint:m,inSine:w,outSine:L,inOutSine:y,outInSine:b,inExpo:A,outExpo:T,inOutExpo:x,outInExpo:C,inCirc:E,outCirc:M,inOutCirc:S,outInCirc:I,inElastic:P,outElastic:B,inOutElastic:O,outInElastic:R,inBack:D,outBack:N,inOutBack:F,outInBack:G,inBounce:_,outBounce:W,inOutBounce:K,outInBounce:j};var U=function(t,i,e){var n,r;for(var o in i)if(i.hasOwnProperty(o))if(n=typeof i[o],r=e.slice(0),r.push(o+""),"number"===n){if("number"!=typeof t[o])throw Error("Parameter '"+r.join("/")+"' is missing from 'from' or isn't a number")}else{if("object"!==n)throw Error("Parameter '"+r.join("/")+"' must be a number or string, was "+i[o]);U(t[o],i[o],r)}},z=function(t,i,e){var n;if("object"==typeof e){n=Array.isArray(e)?[]:{};for(var r in e)e.hasOwnProperty(r)&&(n[r]=z(t,i[r],e[r]))}else n=t.easing(t.runningTime,i,e-i,t.timeToFinish);return n},q=function(t){return t=t||"linear","string"==typeof t?Luv.Timer.Tween.easing[t]:t},H=function(t,i,e){if(e=e||i,"object"==typeof i){t=t||(Array.isArray(i)?[]:{});for(var n in i)i.hasOwnProperty(n)&&(t[n]=H(t[n],i[n],e[n]))}else t=i;return t},Q=function(t,i){return H(null,t,i)}}(),function(){Luv.Keyboard=Luv.Class("Luv.Keyboard",{init:function(t){var i=this;return i.keysDown={},i.el=t,t.addEventListener("keydown",function(t){t.preventDefault(),t.stopPropagation();var e=n(t);i.keysDown[e]=!0,i.onPressed(e,t.which)}),t.addEventListener("keyup",function(t){t.preventDefault(),t.stopPropagation();var e=n(t);i.keysDown[e]=!1,i.onReleased(e,t.which)}),i},onPressed:function(){},onReleased:function(){},isDown:function(t){return!!this.keysDown[t]}});var t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",45:"insert",46:"delete",37:"left",38:"up",39:"right",40:"down",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},e={16:"rshift",17:"rctrl",18:"ralt"},n=function(n){var r,o=n.which;return r=n.keyLocation&&n.keyLocation>1?e[o]:n.shiftKey?i[o]||t[o]:t[o],r===void 0&&(r=String.fromCharCode(o),n.shiftKey&&(r=r.toUpperCase())),r}}(),function(){Luv.Mouse=Luv.Class("Luv.Mouse",{init:function(t){var n=this;n.x=0,n.y=0,n.pressedButtons={},n.wheelTimeOuts={};var r=function(t){n.pressedButtons[t]=!0,n.onPressed(n.x,n.y,t)},o=function(t){n.pressedButtons[t]=!1,n.onReleased(n.x,n.y,t)},s=function(t){t.preventDefault();var i=e(t);clearTimeout(n.wheelTimeOuts[i]),n.wheelTimeOuts[i]=setTimeout(function(){o(i)},1e3*Luv.Mouse.WHEEL_TIMEOUT),r(i)};t.addEventListener("mousemove",function(i){var e=t.getBoundingClientRect();n.x=i.pageX-e.left,n.y=i.pageY-e.top,n.onMoved(n.x,n.y)}),t.addEventListener("mousedown",function(t){r(i(t))}),t.addEventListener("mouseup",function(t){o(i(t))}),t.addEventListener("DOMMouseScroll",s),t.addEventListener("mousewheel",s)},getX:function(){return this.x},getY:function(){return this.y},getPosition:function(){return{x:this.x,y:this.y}},onPressed:function(){},onReleased:function(){},onMoved:function(){},isPressed:function(t){return!!this.pressedButtons[t]}}),Luv.Mouse.WHEEL_TIMEOUT=.02;var t={1:"l",2:"m",3:"r"},i=function(i){return t[i.which]},e=function(t){var i=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));return 1===i?"wu":"wd"}}(),function(){Luv.Touch=Luv.Class("Luv.Touch",{init:function(t){var n=this;n.fingers={},n.el=t;var r=function(t){t.preventDefault(),t.stopPropagation()};t.addEventListener("gesturestart",r),t.addEventListener("gesturechange",r),t.addEventListener("gestureend",r),t.addEventListener("touchstart",function(o){r(o);for(var s,u,a=t.getBoundingClientRect(),h=0;o.targetTouches.length>h;h++)s=o.targetTouches[h],u=e(n,s.identifier),u||(u={identifier:s.identifier,position:i(n),x:s.pageX-a.left,y:s.pageY-a.top},n.fingers[u.position]=u,n.onPressed(u.position,u.x,u.y))});var o=function(i){r(i);var o,s;t.getBoundingClientRect();for(var u=0;i.changedTouches.length>u;u++)o=i.changedTouches[u],s=e(n,o.identifier),s&&(delete n.fingers[s.position],n.onReleased(s.position,s.x,s.y))};t.addEventListener("touchend",o),t.addEventListener("touchleave",o),t.addEventListener("touchcancel",o),t.addEventListener("touchmove",function(i){r(i);for(var o,s,u=t.getBoundingClientRect(),a=0;i.targetTouches.length>a;a++)o=i.targetTouches[a],s=e(n,o.identifier),s&&(s.x=o.pageX-u.left,s.y=o.pageY-u.top,n.onMoved(s.position,s.x,s.y))})},onPressed:function(){},onReleased:function(){},onMoved:function(){},isPressed:function(t){return!!this.fingers[t]},getFinger:function(t){var i=this.fingers[t];return i&&{position:i.position,identifier:i.identifier,x:i.x,y:i.y}},getFingers:function(){for(var t,i,e=[],n=Object.keys(this.fingers).sort(),r=0;n.length>r;r++)i=n[r],t=this.fingers[i],e.push({position:i,x:t.x,y:t.y});return e},isAvailable:function(){return void 0!==window.ontouchstart}});var t=function(t){var i=Object.keys(t.fingers);return 0===i.length?0:Math.max.apply(Math,i)},i=function(i){for(var e=t(i),n=1;e>n;n++)if(!i.isPressed(n))return n;return e+1},e=function(t,i){var e=t.fingers;for(var n in e)if(e.hasOwnProperty(n)&&e[n].identifier==i)return e[n]}}(),function(){Luv.Media=Luv.Class("Luv.Media",{init:function(){this.pending=0,this.loaded=!0},isLoaded:function(){return this.loaded},getPending:function(){return this.pending},onAssetLoaded:function(){},onAssetError:function(t){throw Error("Could not load "+t)},onLoaded:function(){},newAsset:function(t){this.pending++,this.loaded=!1,clearTimeout(this.onLoadedTimeout),t.status="pending"},registerLoad:function(t){if(this.pending--,t.status="loaded",this.onAssetLoaded(t),0===this.pending){var i=this;clearTimeout(this.onLoadedTimeout),this.onLoadedTimeout=setTimeout(function(){i.loaded=!0,i.onLoaded()},Luv.Timer.ONLOAD_TIMEOUT)}},registerError:function(t){this.pending--,t.status="error",this.onAssetError(t)}}),Luv.Timer.ONLOAD_TIMEOUT=200,Luv.Media.Asset={isPending:function(){return"pending"==this.status},isLoaded:function(){return"loaded"==this.status},isError:function(){return"error"==this.status}}}(),function(){Luv.Audio=Luv.Class("Luv.Audio",{init:function(t){this.media=t},isAvailable:function(){return Luv.Audio.isAvailable()},getSupportedTypes:function(){return Luv.Audio.getSupportedTypes()},canPlayType:function(t){return this.supportedTypes[t.toLowerCase()]},Sound:function(){if(this.isAvailable()){var t=[this.media].concat(Array.prototype.slice.call(arguments,0));return Luv.Audio.Sound.apply(Luv.Audio.Sound,t)}return Luv.Audio.NullSound()}}),Luv.Audio.isAvailable=function(){return e},Luv.Audio.canPlayType=function(t){return!!i[t.toLowerCase()]},Luv.Audio.getSupportedTypes=function(){return Object.keys(i)};var t=document.createElement("audio"),i={},e=!!t.canPlayType;e&&(i.ogg=!!t.canPlayType('audio/ogg; codecs="vorbis"'),i.mp3=!!t.canPlayType("audio/mpeg;"),i.wav=!!t.canPlayType('audio/wav; codecs="1"'),i.m4a=!!t.canPlayType("audio/x-m4a;"),i.aac=!!t.canPlayType("audio/aac;"))}(),function(){Luv.Audio.Sound=Luv.Class("Luv.Audio.Sound",{init:function(t){var i=Array.prototype.slice.call(arguments,1);if(0===i.length)throw Error("Must provide at least one path for the Sound");if(i=i.filter(r),0===i.length)throw Error("None of the provided sound types ("+i.join(", ")+") is supported by the browser: ("+Luv.Audio.getSupportedTypes().join(", ")+")");var e=this;e.path=i[0],t.newAsset(e);var n=e.el=document.createElement("audio");n.preload="auto",n.addEventListener("canplaythrough",function(){e.isLoaded()||t.registerLoad(e)}),n.addEventListener("error",function(){t.registerError(e)}),n.src=e.path,n.load(),e.instances=[],e.expirationTime=Luv.Audio.Sound.DEFAULT_EXPIRATION_TIME},toString:function(){return'Luv.Audio.Sound("'+this.path+'")'},play:function(t){if(!this.isLoaded())throw Error("Attepted to play a non loaded sound: "+this);var i=this.getReadyInstance(t);return i.play(),i},pause:function(){this.instances.forEach(function(t){t.pause()})},stop:function(){this.instances.forEach(function(t){t.stop()})},countInstances:function(){return this.instances.length},countPlayingInstances:function(){var t=0;return this.instances.forEach(function(i){t+=i.isPlaying()?1:0}),t},getReadyInstance:function(e){var n=t(this.instances);return n||(n=i(this),this.instances.push(n)),n.reset(this.el,e),n},getExpirationTime:function(){return this.expirationTime},setExpirationTime:function(t){this.expirationTime=t}}),Luv.Audio.Sound.DEFAULT_EXPIRATION_TIME=3,Luv.Audio.Sound.include(Luv.Media.Asset),Luv.Audio.SoundMethods={setVolume:function(t){t=o(t,0,1),this.el.volume=t},getVolume:function(){return this.el.volume},setLoop:function(t){this.loop=!!t,t?this.el.loop="loop":this.el.removeAttribute("loop")},getLoop:function(){return this.loop},setSpeed:function(t){this.el.playbackRate=t},getSpeed:function(){return this.el.playbackRate},setTime:function(t){try{this.el.currentTime=t}catch(i){}},getTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration}},Luv.Audio.Sound.include(Luv.Audio.SoundMethods);var t=function(t){for(var i,e=0;t.length>e;e++)if(i=t[e],i.isReady())return i},i=function(t){return Luv.Audio.SoundInstance(t.el.cloneNode(!0),function(){clearTimeout(this.expirationTimeOut)},function(){var i=this;i.expirationTimeOut=setTimeout(function(){e(t,i)},1e3*t.getExpirationTime())})},e=function(t,i){var e=t.instances.indexOf(i);-1!=e&&t.instances.splice(e,1)},n=function(t){var i=t.match(/.+\.([^?]+)(\?|$)/);return i?i[1].toLowerCase():""},r=function(t){return Luv.Audio.canPlayType(n(t))},o=function(t,i,e){return Math.max(i,Math.min(e,Number(t)))}}(),function(){Luv.Audio.SoundInstance=Luv.Class("Luv.Audio.SoundInstance",{init:function(t,i,e){var n=this;n.el=t,n.onPlay=i,n.onStop=e,n.el.addEventListener("ended",function(){n.stop()})},reset:function(t,i){i=i||{};var e=i.volume===void 0?t.volume:i.volume,n=i.loop===void 0?!!t.loop:i.loop,r=i.speed===void 0?t.playbackRate:i.speed,o=i.time===void 0?t.currentTime:i.time,s=i.status===void 0?"ready":i.status;this.setVolume(e),this.setLoop(n),this.setSpeed(r),this.setTime(o),this.status=s},play:function(){this.el.play(),this.status="playing",this.onPlay()},pause:function(){this.isPlaying()&&(this.el.pause(),this.status="paused")},stop:function(){this.el.pause(),this.setTime(0),this.status="ready",this.onStop()},isPaused:function(){return"paused"==this.status},isReady:function(){return"ready"==this.status},isPlaying:function(){return"playing"==this.status},onPlay:function(){},onStop:function(){}}),Luv.Audio.SoundInstance.include(Luv.Audio.SoundMethods)}(),function(){Luv.Audio.NullSound=Luv.Class("Luv.Audio.NullSound");var t={},i=function(){return 0};for(var e in Luv.Audio.Sound.methods)Luv.Audio.Sound.methods.hasOwnProperty(e)&&(t[e]=i);Luv.Audio.NullSound.include(t,{play:function(){return Luv.Audio.SoundInstance(n())}});var n=function(){return{volume:1,playbackRate:1,loop:void 0,currentTime:0,play:function(){},pause:function(){},addEventListener:function(t,i){i()}}}}(),function(){Luv.Graphics=Luv.Class("Luv.Graphics",{init:function(t,i){this.el=t,this.media=i},parseColor:function(t,i,e){return Luv.Graphics.parseColor(t,i,e)},Canvas:function(t,i){return t=t||this.el.getAttribute("width"),i=i||this.el.getAttribute("height"),Luv.Graphics.Canvas(t,i)},Image:function(t){return Luv.Graphics.Image(this.media,t)},Sprite:function(t,i,e,n,r){return Luv.Graphics.Sprite(t,i,e,n,r)},SpriteSheet:function(t,i,e,n,r,o){return Luv.Graphics.SpriteSheet(t,i,e,n,r,o)}}),Luv.Graphics.parseColor=function(t,i,e){var n,r=parseInt;if(Array.isArray(t))return{r:t[0],g:t[1],b:t[2]};if("object"==typeof t)return{r:t.r,g:t.g,b:t.b};if("string"==typeof t){if(t=t.replace(/#|\s+/g,""),n=/^([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))return{r:r(n[1],16),g:r(n[2],16),b:r(n[3],16)};if(n=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t))return{r:17*r(n[1],16),g:17*r(n[2],16),b:17*r(n[3],16)};if(n=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(t))return{r:r(n[1],10),g:r(n[2],10),b:r(n[3],10)}}return{r:t,g:i,b:e}}}(),function(){Luv.Graphics.Animation=Luv.Class("Luv.Graphics.Animation",{init:function(i,n){if(!Array.isArray(i))throw Error("Array of sprites needed. Got "+i);if(0===i.length)throw Error("No sprites where provided. Must provide at least one");this.sprites=i.slice(0),this.time=0,this.index=0,this.durations=e(i.length,n),this.intervals=t(this.durations),this.loopDuration=this.intervals[this.intervals.length-1]},update:function(t){var e;this.time+=t,e=Math.floor(this.time/this.loopDuration),this.time-=this.loopDuration*e,0!==e&&this.onLoopEnded(e),this.index=i(this.intervals,this.time)},gotoSprite:function(t){this.index=t,this.time=this.intervals[t]},getCurrentSprite:function(){return this.sprites[this.index]},onLoopEnded:function(){}}),"getWidth getHeight getDimensions getCenter drawInCanvas".split(" ").forEach(function(t){Luv.Graphics.Animation.methods[t]=function(){var i=this.getCurrentSprite();return i[t].apply(i,arguments)}});var t=function(t){for(var i=[0],e=0,n=0;t.length>n;n++)e+=t[n],i.push(e);return i},i=function(t,i){for(var e=t.length-2,n=0,r=0;e>=n;)if(r=Math.floor((n+e)/2),i>=t[r+1])n=r+1;else{if(!(t[r]>i))break;e=r-1}return r},e=function(t,i){var e,r,o,s,u=[];if(Array.isArray(i))u=i.slice(0);else if("object"==typeof i){u.length=t;for(e in i)if(i.hasOwnProperty(e))for(o=n(e),s=Number(i[e]),r=0;o.length>r;r++)u[o[r]]=s}else for(i=Number(i),r=0;t>r;r++)u.push(i);if(u.length!=t)throw Error("The durations table length should be "+t+", but it is "+u.length);for(r=0;u.length>r;r++){if(u[r]===void 0)throw Error("Missing delay for sprite "+r);if(isNaN(u[r]))throw Error("Could not parse the delay for sprite "+r)}return u},n=function(t){var i,e,n,r,o;if("string"!=typeof t)throw Error("Unknown range type (must be integer or string in the form 'start-end'): "+t);if(i=t.match(/^(\d+)-(\d+)$/))if(e=[],n=Number(i[1]),r=Number(i[2]),r>n)for(o=n;r>=o;o++)e.push(o);else for(o=n;o>=r;o--)e.push(o);else e=[Number(t)];return e}}(),function(){Luv.Graphics.Canvas=Luv.Class("Luv.Graphics.Canvas",{init:function(t,i){var e;t.getAttribute?(e=t,t=e.getAttribute("width"),i=e.getAttribute("height")):(e=document.createElement("canvas"),e.setAttribute("width",t),e.setAttribute("height",i)),this.el=e,this.ctx=e.getContext("2d"),this.color={},this.backgroundColor={},this.setBackgroundColor(0,0,0),this.setColor(255,255,255),this.setLineCap("butt"),this.setLineWidth(1),this.setImageSmoothing(!0),this.setAlpha(1)},clear:function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.globalAlpha=1,this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.getWidth(),this.getHeight()),this.ctx.restore()},print:function(t,i,e){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(t,i,e)},line:function(){var t=Array.isArray(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),n(this,"luv.graphics.line",4,t),s(this,f.STROKE)},strokeRectangle:function(t,i,e,n){u(this,f.STROKE,t,i,e,n)},fillRectangle:function(t,i,e,n){u(this,f.FILL,t,i,e,n)},strokePolygon:function(){a(this,f.STROKE,arguments)},fillPolygon:function(){a(this,f.FILL,arguments)},strokeCircle:function(t,i,e){c(this,f.STROKE,t,i,e)},fillCircle:function(t,i,e){c(this,f.FILL,t,i,e)},strokeArc:function(t,i,e,n,r){h(this,f.STROKE,t,i,e,n,r)},fillArc:function(t,i,e,n,r){h(this,f.FILL,t,i,e,n,r)},draw:function(t,i,e,n,o,s,u,a){var h=this.ctx;i=i||0,e=e||0,o=o||1,s=s||1,u=u||0,a=a||0,n=r(n||0),0!==n||1!==o||1!==s||0!==u||0!==a?(h.save(),h.translate(i,e),h.translate(u,a),h.rotate(n),h.scale(o,s),h.translate(-u,-a),t.drawInCanvas(this,0,0),h.restore()):t.drawInCanvas(this,i,e)},drawCentered:function(t,i,e,n,r,o){var s=t.getCenter();this.draw(t,i-s.x,e-s.y,n,r,o,s.x,s.y)},drawInCanvas:function(t,i,e){t.ctx.drawImage(this.el,i,e)},translate:function(t,i){this.ctx.translate(t,i)},scale:function(t,i){this.ctx.scale(t,i)},rotate:function(t){this.ctx.rotate(t)},push:function(){this.ctx.save()},pop:function(){this.ctx.restore()},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimensions:function(t,i){this.el.setAttribute("width",t),this.el.setAttribute("height",i)},getWidth:function(){return Number(this.el.getAttribute("width"))},getHeight:function(){return Number(this.el.getAttribute("height"))},getCenter:function(){return{x:this.getWidth()/2,y:this.getHeight()/2}},setColor:function(t,e,n){i(this,"color",t,e,n)},getColor:function(){return e(this.color)},setBackgroundColor:function(t,e,n){i(this,"backgroundColor",t,e,n)},getBackgroundColor:function(){return e(this.backgroundColor)},setAlpha:function(t){this.alpha=l(t,0,1),this.ctx.globalAlpha=this.alpha},getAlpha:function(){return this.alpha},setLineWidth:function(t){this.lineWidth=t,this.ctx.lineWidth=t},getLineWidth:function(){return this.lineWidth},setLineCap:function(t){if("butt"!=t&&"round"!=t&&"square"!=t)throw Error("Line cap must be either 'butt', 'round' or 'square' (was: "+t+")");this.ctx.lineCap=t,this.lineCap=this.ctx.lineCap},getLineCap:function(){return this.lineCap},setImageSmoothing:function(t){this.imageSmoothing=t=!!t,o(this.ctx,t)},getImageSmoothing:function(){return this.imageSmoothing}});var t=2*Math.PI,i=function(t,i,e,n,r){var o=t[i],s=Luv.Graphics.parseColor(e,n,r);Luv.extend(o,s),t[i+"Style"]="rgb("+[o.r,o.g,o.b].join()+")"},e=function(t){return{r:t.r,g:t.g,b:t.b}},n=function(t,i,e,n){if(e>n.length)throw Error(i+" requires at least 4 parameters");if(1==n.length%2)throw Error(i+" requires an even number of parameters");t.ctx.moveTo(n[0],n[1]);for(var r=2;n.length>r;r+=2)t.ctx.lineTo(n[r],n[r+1]);t.ctx.stroke()},r=function(i){return i%=t,0>i?i+t:i},o=function(t,i){t.webkitImageSmoothingEnabled=i,t.mozImageSmoothingEnabled=i,t.imageSmoothingEnabled=i},s=function(t,i){switch(i){case f.FILL:t.ctx.fillStyle=t.colorStyle,t.ctx.fill();break;case f.STROKE:t.ctx.strokeStyle=t.colorStyle,t.ctx.stroke();break;default:throw Error("Invalid mode: ["+i+']. Should be "fill" or "line"')}},u=function(t,i,e,n,r,o){t.ctx.beginPath(),t.ctx.rect(e,n,r,o),s(t,i),t.ctx.closePath()},a=function(t,i,e){var r=Array.isArray(e[0])?e[0]:Array.prototype.slice.call(e,0);t.ctx.beginPath(),n(t,"luv.Graphics.Canvas.polygon",6,r),s(t,i),t.ctx.closePath()},h=function(t,i,e,n,r,o,u){t.ctx.beginPath(),t.ctx.arc(e,n,r,o,u,!1),s(t,i)},c=function(i,e,n,r,o){h(i,e,n,r,o,0,t),i.ctx.closePath()},f={STROKE:1,FILL:2},l=function(t,i,e){return Math.max(i,Math.min(e,Number(t)))}}(),function(){Luv.Graphics.Image=Luv.Class("Luv.Graphics.Image",{init:function(t,i){var e=this;e.path=i,t.newAsset(e);var n=new Image;e.source=n,n.addEventListener("load",function(){t.registerLoad(e)}),n.addEventListener("error",function(){t.registerError(e)}),n.src=i},toString:function(){return'instance of Luv.Graphics.Image("'+this.path+'")'},getWidth:function(){return this.source.width},getHeight:function(){return this.source.height},getDimensions:function(){return{width:this.source.width,height:this.source.height}},getCenter:function(){return{x:this.source.width/2,y:this.source.height/2}},drawInCanvas:function(t,i,e){if(!this.isLoaded())throw Error("Attepted to draw a non loaded image: "+this);t.ctx.drawImage(this.source,i,e)}}),Luv.Graphics.Image.include(Luv.Media.Asset)}(),function(){Luv.Graphics.Sprite=Luv.Class("Luv.Graphics.Sprite",{init:function(t,i,e,n,r){this.image=t,this.left=i,this.top=e,this.width=n,this.height=r},toString:function(){return["instance of Luv.Graphics.Sprite(",this.image,", ",this.left,", ",this.top,", ",this.width,", ",this.height,")"].join("")},getImage:function(){return this.image},getWidth:function(){return this.width},getHeight:function(){return this.height},getDimensions:function(){return{width:this.width,height:this.height}},getCenter:function(){return{x:this.width/2,y:this.height/2}},getBoundingBox:function(){return{left:this.left,top:this.top,width:this.width,height:this.height}},drawInCanvas:function(t,i,e){if(!this.image.isLoaded())throw Error("Attepted to draw a prite of a non loaded image: "+this);t.ctx.drawImage(this.image.source,this.left,this.top,this.width,this.height,i,e,this.width,this.height)}})}(),function(){Luv.Graphics.SpriteSheet=Luv.Class("Luv.Graphics.SpriteSheet",{init:function(t,i,e,n,r,o){this.image=t,this.width=i,this.height=e,this.left=n||0,this.top=r||0,this.border=o||0},getSprites:function(){for(var i,e,n=[],r=0;arguments.length>r;r+=2){i=t(arguments[r]),e=t(arguments[r+1]);for(var o=0;e.length>o;o++)for(var s=0;i.length>s;s++)n.push(this.Sprite(i[s],e[o]))}return n},Sprite:function(t,i){return Luv.Graphics.Sprite(this.image,this.left+this.width*t+this.border*(t+1),this.top+this.height*i+this.border*(i+1),this.width,this.height)},Animation:function(t,i){var e=this.getSprites.apply(this,t);return Luv.Graphics.Animation(e,i)}});var t=function(t){if("number"==typeof t)return[t];if("string"==typeof t){var i=t.split("-");if(2!=i.length)throw Error("Could not parse from '"+t+"'. Must be of the form 'start-end'");var e,n=[],r=Number(i[0]),o=Number(i[1]);if(o>r)for(e=r;o>=e;e++)n.push(e);else for(e=r;e>=o;e--)n.push(e);return n}throw Error("Ranges must be integers or strings of the form 'start-end'. Got "+t)}}(),function(){Luv.Collider=Luv.Class("Luv.Collider",{World:function(t){return Luv.Collider.World(t)},AABB:function(t,i,e,n){return Luv.Collider.AABB(t,i,e,n)}}),Luv.Collider.DEFAULT_CELL_SIZE=64}(),function(){Luv.Collider.AABB=Luv.Class("Luv.Collider.AABB",{init:function(t,i,e,n){this.setDimensions(t,i,e,n)},setDimensions:function(t,i,e,n){this.t=i,this.l=t,this.w=e,this.h=n,this.r=t+e,this.b=i+n},getCenter:function(){return{x:this.l+this.w/2,y:this.t+this.h/2}},clone:function(){return Luv.Collider.AABB(this.l,this.t,this.w,this.h)},containsPoint:function(t,i){return t>this.l&&this.r>t&&i>this.t&&this.b>i},isIntersecting:function(t){return this.l<t.r&&this.r>t.l&&this.t<t.b&&this.b>t.t},getMinkowskyDiff:function(t){return Luv.Collider.AABB(t.l-this.r,t.t-this.b,t.w+this.w,t.h+this.h)},getSegmentIntersection:function(t,e,n,r){return i(this,t,e,n-t,r-e,0,1)},getLineIntersection:function(t,e,n,r){return i(this,t,e,n,r,Number.MIN_VALUE,Number.MAX_VALUE)},getRayIntersection:function(t,e,n,r){return i(this,t,e,n,r,0,Number.MAX_VALUE)},toGrid:function(t){var i=Math.floor(this.l/t),e=Math.floor(this.t/t),n=Math.ceil(this.r/t),r=Math.ceil(this.b/t);return Luv.Collider.AABB(i,e,n-i,r-e)
},getCoveringAABB:function(t){var i=Math.min(this.l,t.l),e=Math.min(this.t,t.t),n=Math.max(this.r,t.r),r=Math.max(this.b,t.b);return Luv.Collider.AABB(i,e,n-i,r-e)},getNearestPointInPerimeter:function(t,i){return{x:Math.abs(this.l-t)<Math.abs(this.r-t)?this.l:this.r,y:Math.abs(this.t-i)<Math.abs(this.b-i)?this.t:this.b}},collide:function(i,e,n){var r,o,s,u,a,h,c,f=this;return(0!==e||0!==n)&&(f=Luv.Collider.AABB(this.l-e,this.t-n,this.w,this.h)),o=f.getMinkowskyDiff(i),o.containsPoint(0,0)?(s=o.getNearestPointInPerimeter(0,0),r={dx:s.x-e,dy:s.y-n,ti:0,tunneling:!1}):(a=t(o,0,0,e,n,0,1),a&&(h=a.t0,c=a.t1,h>0&&1>h?u=h:c>0&&1>c&&(u=c),u?r={dx:e*u-e,dy:n*u-n,ti:u,tunneling:!0}:(o=this.getMinkowskyDiff(i),o.containsPoint(0,0)&&(s=o.getNearestPointInPerimeter(0,0),r={dx:s.x,dy:s.y,ti:1,tunneling:!1})))),r}});var t=function(t,i,e,n,r,o,s){for(var u,a,h,c=o||0,f=s||1,l=0;4>l;l++){switch(l){case 0:u=-n,a=i-t.l;break;case 1:u=n,a=t.r-i;break;case 2:u=-r,a=e-t.t;break;default:u=r,a=t.b-e}if(0===u){if(0>a)return}else if(h=a/u,0>u){if(h>f)return;h>c&&(c=h)}else{if(c>h)return;f>h&&(f=h)}}return{t0:c,t1:f}},i=function(i,e,n,r,o,s,u){var a=t(i,e,n,r,o,s,u);if(a){var h=a.t0,c=a.t1;return a.x0=e+h*r,a.y0=n+h*o,a.x1=e+c*r,a.y1=n+c*o,a.dx=r,a.dy=o,a}}}(),function(){var t=64,i=Luv.Collider.AABB;Luv.Collider.World=Luv.Class("Luv.Collider.World",{init:function(i,e){this.cellSize=i||t,this.items={},this.aabbs={},this.rows={},this.itemCount=0,this.maxId=0,this.id=e||"world",this.itemsKey="_"+this.id+"_id"},getAABB:function(t){var i=this.itemsKey;if(!t[i])throw Error("item must have the property "+i+" in order to obtain its aabb");var e=t[i];return this.aabbs[e]},count:function(){return this.itemCount},add:function(t,n,r,o,s){var u=this.itemsKey;if(t[u])throw Error("item must not have the property "+u+" when inserting it in the world");var a=++this.maxId;return t[u]=a,this.aabbs[a]=i(n,r,o,s),this.items[a]=t,this.itemCount++,e(this,a,this.aabbs[a]),this.check(t)},move:function(t,i,r,o,s){var u=t[this.itemsKey];if(!u)throw Error("item must have the property "+this.itemsKey+" in order to be moved");var a=this.aabbs[u];if(!a)throw Error("item "+u+" is not in the world. Add it to the world before trying to move it");var h=a.l,c=a.t;if(o=o===void 0?a.w:o,s=s===void 0?a.h:s,a.w!=o||a.h!=s){var f=a.getCenter();h=f.x-o/2,c=f.y-s/2}return(a.w!=o||a.h!=s||a.l!=i||a.t!=r)&&(n(this,u,a),a.setDimensions(i,r,o,s),e(this,u,a)),this.check(t,h,c)},check:function(t,e,n){var o=t[this.itemsKey];if(!o)throw Error("item was not inserted into the world before being checked");var s=this.aabbs[o];if(!s)throw Error("item with id "+o+" was not inserted in the world");var u=s.l,a=s.t;e=e===void 0?u:e,n=n===void 0?a:n;var h=u-e,c=a-n,f=[],l={},d=s;if(e!==u||n!==a){var v=i(e,n,s.w,s.h);d=s.getCoveringAABB(v)}var g=d.toGrid(this.cellSize);l[o]=!0;for(var p=g.t;g.b>=p;p++){var m=this.rows[p];if(m)for(var w=g.l;g.r>=w;w++){var L=m[w];if(L&&0!==L.itemCount)for(var y in L.ids)if(!l[y]&&L.ids.hasOwnProperty(y)){l[y]=!0;var b=this.aabbs[y],A=s.collide(b,h,c);A&&(A.item=this.items[y],f.push(A))}}}return f.sort(r)},remove:function(t){var i=t[this.itemsKey];if(!i)throw Error("item must have property "+this.itemsKey+" in order to be removed from the world");var e=this.aabbs[i];if(!e)throw Error("item "+i+" is not in the world. Add it to the world before trying to remove it");n(this,i,e),delete this.aabbs[i],delete this.items[i],this.itemCount--},toGrid:function(t,i){return{x:Math.floor(t/this.cellSize),y:Math.floor(i/this.cellSize)}},fromGrid:function(t,i){return{x:t*this.cellSize,y:i*this.cellSize}}});var e=function(t,i,e){for(var n=e.toGrid(t.cellSize),r=n.t;n.b>=r;r++)for(var o=t.rows[r]=t.rows[r]||{},s=n.l;n.r>=s;s++){var u=o[s]=o[s]||{itemCount:0,x:s,y:r,ids:{}};u.ids[i]||(u.ids[i]=!0,u.itemCount++)}},n=function(t,i,e){for(var n=e.toGrid(t.cellSize),r=n.t;n.b>=r;r++){var o=t.rows[r];if(o)for(var s=n.l;n.r>=s;s++){var u=o[s];u&&u.ids[i]&&(delete u.ids[i],u.itemCount--)}}},r=function(t,i){var e=t.ti-i.ti;return e?0>e?-1:1:0}}();