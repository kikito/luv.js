/*! luv 0.0.1 (2013-11-17) - https://github.com/kikito/luv.js */
/*! Minimal HTML5 game development lib */
/*! Enrique Garcia Cota */
(function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define("Luv",[],e):t.Luv=e()})(this,function(){var t=function(){var t=function(t){for(var e,n=1;arguments.length>n;n++){e=arguments[n];for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}return t},e=function(t,e){e=Array.isArray(e)?e:[e];for(var n=0;e.length>n;n++)delete t[e[n]];return t},n=Object.create,i={toString:function(){return"instance of "+this.getClass().getName()}},r=t(function(){return n(i)},{init:function(){},getName:function(){return"Base"},toString:function(){return"Base"},getSuper:function(){return null},methods:i,include:function(){return t.apply(this,[this.methods].concat(Array.prototype.slice.call(arguments,0)))},subclass:function(i,r){r=r||{};var o=this,s=function(){return i},u=e(t(n(o.methods),r),"init"),a=t(function(){var t=n(u);return a.init.apply(t,arguments),t},o,r,{getName:s,toString:s,getSuper:function(){return o},methods:u});return u.getClass=function(){return a},a}});i.getClass=function(){return r};var o=r.subclass("Luv",{init:function(t){t=s(t);var e=this;if(e.el=t.el,e.el.tabIndex=1,"load update draw run onResize onBlur onFocus".split(" ").forEach(function(n){t[n]&&(e[n]=t[n])}),e.media=o.Media(),e.timer=o.Timer(),e.keyboard=o.Keyboard(e.el),e.mouse=o.Mouse(e.el),e.touch=o.Touch(e.el),e.audio=o.Audio(e.media),e.graphics=o.Graphics(e.el,e.media),e.canvas=o.Graphics.Canvas(e.el),t.fullWindow){var n=function(){e.canvas.setDimensions(window.innerWidth,window.innerHeight),e.onResize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",n,!1),window.addEventListener("orientationChange",n,!1),e.el.focus()}e.el.addEventListener("blur",function(){e.onBlur()}),e.el.addEventListener("focus",function(){e.onFocus()})},load:function(){},draw:function(){},update:function(){},run:function(){var t=this;t.load();var e=function(){t.timer.nativeUpdate(t.el);var n=t.timer.getDeltaTime();t.update(n),t.canvas.clear(),t.draw(),t.timer.nextFrame(e)};t.timer.nextFrame(e)},onResize:function(){},onBlur:function(){},onFocus:function(){}});o.Class=function(t,e){return r.subclass(t,e)},o.Base=r,o.extend=t;var s=function(t){t=t||{};var e=t.el,n=t.id,i=t.width,r=t.height,o=document.getElementsByTagName("body")[0],s=document.getElementsByTagName("html")[0],u="width: 100%; height: 100%; margin: 0; overflow: hidden;";return!e&&n&&(e=document.getElementById(n)),e?(!i&&e.getAttribute("width")&&(i=Number(e.getAttribute("width"))),!r&&e.getAttribute("height")&&(r=Number(e.getAttribute("height")))):(e=document.createElement("canvas"),o.appendChild(e)),t.fullWindow?(s.style.cssText=o.style.cssText=u,i=window.innerWidth,r=window.innerHeight):(i=i||800,r=r||600),e.setAttribute("width",i),e.setAttribute("height",r),t.el=e,t.width=i,t.height=r,t};return o}();return function(){t.Timer=t.Class("Luv.Timer",{init:function(){this.microTime=n.now(),this.deltaTime=0,this.deltaTimeLimit=t.Timer.DEFAULT_DELTA_TIME_LIMIT,this.events={},this.maxEventId=0},nativeUpdate:function(t){this.update((n.now()-this.microTime)/1e3,t)},update:function(t){this.deltaTime=Math.max(0,Math.min(this.deltaTimeLimit,t)),this.microTime+=1e3*t;for(var e in this.events)this.events.hasOwnProperty(e)&&this.events[e].update(t)&&delete this.events[e]},setDeltaTimeLimit:function(t){this.deltaTimeLimit=t},getDeltaTimeLimit:function(){return this.deltaTimeLimit},getDeltaTime:function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},getFPS:function(){return 0===this.deltaTime?0:1/this.deltaTime},nextFrame:function(t){r(t)},after:function(n,i,r){return e(this,t.Timer.After(n,i,r))},every:function(n,i,r){return e(this,t.Timer.Every(n,i,r))},tween:function(n,i,r,o){return e(this,t.Timer.Tween(n,i,r,o))},clear:function(t){return this.events[t]?(delete this.events[t],!0):!1}}),t.Timer.DEFAULT_DELTA_TIME_LIMIT=.25;var e=function(t,e){var n=t.maxEventId++;return t.events[n]=e,n},n=window.performance||Date;n.now=n.now||n.msNow||n.mozNow||n.webkitNow||Date.now;var i=0,r=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(t){var e=n.now(),r=Math.max(0,16-(e-i)),o=setTimeout(function(){t(e+r)},r);return i=e+r,o}}(),function(){t.Timer.After=t.Class("Luv.Timer.After",{init:function(t,e,n){this.timeRunning=0,this.timeToCall=t,this.callback=e,this.context=n},update:function(t){this.timeRunning+=t;var e=this.timeRunning-this.timeToCall;return e>=0?(this.callback.call(this.context,e),!0):!1}})}(),function(){t.Timer.Every=t.Class("Luv.Timer.Every",{init:function(t,e,n){this.timeRunning=0,this.timeToCall=t,this.callback=e,this.context=n},update:function(t){if(this.timeRunning+=t,this.timeToCall>0)for(;this.timeRunning>=this.timeToCall;)this.callback.call(this.context,this.timeRunning-this.timeToCall),this.timeRunning-=this.timeToCall;else this.callback.call(this.context,t);return!1}})}(),function(){t.Timer.Tween=t.Class("Luv.Timer.Tween",{init:function(t,e,n,i){K(e,n,[]),i=i||{},this.easing=U(i.easing),this.every=i.every||this.every,this.after=i.after||this.after,this.context=i.context||this,this.runningTime=0,this.finished=!1,this.timeToFinish=t,this.subject=e,this.from=X(e,n),this.to=X(n)},update:function(t){return this.runningTime>=this.timeToFinish?void 0:(this.runningTime+=t,this.runningTime>=this.timeToFinish&&(this.runningTime=this.timeToFinish,this.after.call(this.context),this.finished=!0),this.every.call(this.context,Q(this,this.from,this.to)),this.finished)},every:function(t){this.subject=z(this.subject,t)},after:function(){},isFinished:function(){return!!this.finished}});var e=function(t,e,n,i){return n*t/i+e},n=function(t,e,n,i){return n*Math.pow(t/i,2)+e},i=function(t,e,n,i){return t/=i,-n*t*(t-2)+e},r=function(t,e,n,i){return t=2*(t/i),1>t?n/2*Math.pow(t,2)+e:-n/2*((t-1)*(t-3)-1)+e},o=function(t,e,r,o){return o/2>t?i(2*t,e,r/2,o):n(2*t-o,e+r/2,r/2,o)},u=function(t,e,n,i){return n*Math.pow(t/i,3)+e},a=function(t,e,n,i){return n*(Math.pow(t/i-1,3)+1)+e},h=function(t,e,n,i){return t=2*(t/i),1>t?n/2*t*t*t+e:(t-=2,n/2*(t*t*t+2)+e)},c=function(t,e,n,i){return i/2>t?a(2*t,e,n/2,i):u(2*t-i,e+n/2,n/2,i)},f=function(t,e,n,i){return n*Math.pow(t/i,4)+e},d=function(t,e,n,i){return-n*(Math.pow(t/i-1,4)-1)+e},l=function(t,e,n,i){return t=2*(t/i),1>t?n/2*Math.pow(t,4)+e:-n/2*(Math.pow(t-2,4)-2)+e},p=function(t,e,n,i){return i/2>t?d(2*t,e,n/2,i):f(2*t-i,e+n/2,n/2,i)},g=function(t,e,n,i){return n*Math.pow(t/i,5)+e},m=function(t,e,n,i){return n*(Math.pow(t/i-1,5)+1)+e},v=function(t,e,n,i){return t=2*(t/i),1>t?n/2*Math.pow(t,5)+e:n/2*(Math.pow(t-2,5)+2)+e},w=function(t,e,n,i){return i/2>t?m(2*t,e,n/2,i):g(2*t-i,e+n/2,n/2,i)},y=function(t,e,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+e},T=function(t,e,n,i){return n*Math.sin(t/i*(Math.PI/2))+e},b=function(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e},A=function(t,e,n,i){return i/2>t?T(2*t,e,n/2,i):y(2*t-i,e+n/2,n/2,i)},L=function(t,e,n,i){return 0===t?e:n*Math.pow(2,10*(t/i-1))+e-.001*n},x=function(t,e,n,i){return t==i?e+n:1.001*n*(-Math.pow(2,-10*t/i)+1)+e},E=function(t,e,n,i){return 0===t?e:t==i?e+n:(t=2*(t/i),1>t?n/2*Math.pow(2,10*(t-1))+e-5e-4*n:1.0005*(n/2)*(-Math.pow(2,-10*(t-1))+2)+e)},C=function(t,e,n,i){return i/2>t?x(2*t,e,n/2,i):L(2*t-i,e+n/2,n/2,i)},S=function(t,e,n,i){return-n*(Math.sqrt(1-Math.pow(t/i,2))-1)+e},M=function(t,e,n,i){return n*Math.sqrt(1-Math.pow(t/i-1,2))+e},I=function(t,e,n,i){return t=2*(t/i),1>t?-n/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,n/2*(Math.sqrt(1-t*t)+1)+e)},k=function(t,e,n,i){return i/2>t?M(2*t,e,n/2,i):S(2*t-i,e+n/2,n/2,i)},P=function(t,e,n,i){return t=t===void 0?.3*i:t,e=e||0,Math.abs(n)>e?(e=n,s=t/4):s=t/(2*Math.PI)*Math.asin(n/e),[t,e,s]},O=function(t,e,n,i,r,o){if(0===t)return e;if(t/=i,1==t)return e+n;var s=P(o,r,n,i),u=s[2];return o=s[0],r=s[1],t-=1,-(r*Math.pow(2,10*t)*Math.sin((t*i-u)*2*Math.PI/o))+e},R=function(t,e,n,i,r,o){if(0===t)return e;if(t/=i,1==t)return e+n;var s=P(o,r,n,i),u=s[2];return o=s[0],r=s[1],r*Math.pow(2,-10*t)*Math.sin((t*i-u)*2*Math.PI/o)+n+e},F=function(t,e,n,i,r,o){if(0===t)return e;if(t/=i,1==t)return e+n;var s=P(o,r,n,i),u=s[2];return o=s[0],r=s[1],t-=1,0>t?-.5*r*Math.pow(2,10*t)*Math.sin((t*i-u)*2*Math.PI/o)+e:.5*r*Math.pow(2,-10*t)*Math.sin((t*i-u)*2*Math.PI/o)+n+e},D=function(t,e,n,i,r,o){return i/2>t?R(2*t,e,n/2,i,r,o):O(2*t-i,e+n/2,n/2,i,r,o)},N=function(t,e,n,i,r){return r=r||1.70158,t/=i,n*t*t*((r+1)*t-r)+e},B=function(t,e,n,i,r){return r=r||1.70158,t=t/i-1,n*(t*t*((r+1)*t+r)+1)+e},G=function(t,e,n,i,r){return r=1.525*(r||1.70158),t=2*(t/i),1>t?n/2*t*t*((r+1)*t-r)+e:(t-=2,n/2*(t*t*((r+1)*t+r)+2)+e)},W=function(t,e,n,i,r){return i/2>t?B(2*t,e,n/2,i,r):N(2*t-i,e+n/2,n/2,i,r)},j=function(t,e,n,i){return t/=i,1/2.75>t?n*7.5625*t*t+e:2/2.75>t?(t-=1.5/2.75,n*(7.5625*t*t+.75)+e):2.5/2.75>t?(t-=2.25/2.75,n*(7.5625*t*t+.9375)+e):(t-=2.625/2.75,n*(7.5625*t*t+.984375)+e)},_=function(t,e,n,i){return n-j(i-t,0,n,i)+e},q=function(t,e,n,i){return i/2>t?.5*_(2*t,0,n,i)+e:.5*j(2*t-i,0,n,i)+.5*n+e},H=function(t,e,n,i){return i/2>t?j(2*t,e,n/2,i):_(2*t-i,e+n/2,n/2,i)};t.Timer.Tween.easing={linear:e,inQuad:n,outQuad:i,inOutQuad:r,outInQuad:o,inCubic:u,outCubic:a,inOutCubic:h,outInCubic:c,inQuart:f,outQuart:d,inOutQuart:l,outInQuart:p,inQuint:g,outQuint:m,inOutQuint:v,outInQuint:w,inSine:y,outSine:T,inOutSine:b,outInSine:A,inExpo:L,outExpo:x,inOutExpo:E,outInExpo:C,inCirc:S,outCirc:M,inOutCirc:I,outInCirc:k,inElastic:O,outElastic:R,inOutElastic:F,outInElastic:D,inBack:N,outBack:B,inOutBack:G,outInBack:W,inBounce:_,outBounce:j,inOutBounce:q,outInBounce:H};var K=function(t,e,n){var i,r;for(var o in e)if(e.hasOwnProperty(o))if(i=typeof e[o],r=n.slice(0),r.push(o+""),"number"===i){if("number"!=typeof t[o])throw Error("Parameter '"+r.join("/")+"' is missing from 'from' or isn't a number")}else{if("object"!==i)throw Error("Parameter '"+r.join("/")+"' must be a number or string, was "+e[o]);K(t[o],e[o],r)}},Q=function(t,e,n){var i;if("object"==typeof n){i=Array.isArray(n)?[]:{};for(var r in n)n.hasOwnProperty(r)&&(i[r]=Q(t,e[r],n[r]))}else i=t.easing(t.runningTime,e,n-e,t.timeToFinish);return i},U=function(e){return e=e||"linear","string"==typeof e?t.Timer.Tween.easing[e]:e},z=function(t,e,n){if(n=n||e,"object"==typeof e){t=t||(Array.isArray(e)?[]:{});for(var i in e)e.hasOwnProperty(i)&&(t[i]=z(t[i],e[i],n[i]))}else t=e;return t},X=function(t,e){return z(null,t,e)}}(),function(){t.Keyboard=t.Class("Luv.Keyboard",{init:function(t){var e=this;return e.keysDown={},e.el=t,t.addEventListener("keydown",function(t){t.preventDefault(),t.stopPropagation();var n=r(t);e.keysDown[n]=!0,e.onPressed(n,t.which)}),t.addEventListener("keyup",function(t){t.preventDefault(),t.stopPropagation();var n=r(t);e.keysDown[n]=!1,e.onReleased(n,t.which)}),e},onPressed:function(){},onReleased:function(){},isDown:function(t){return!!this.keysDown[t]}});var e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",45:"insert",46:"delete",37:"left",38:"up",39:"right",40:"down",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},i={16:"rshift",17:"rctrl",18:"ralt"},r=function(t){var r,o=t.which;return r=t.keyLocation&&t.keyLocation>1?i[o]:t.shiftKey?n[o]||e[o]:e[o],r===void 0&&(r=String.fromCharCode(o),t.shiftKey&&(r=r.toUpperCase())),r}}(),function(){t.Mouse=t.Class("Luv.Mouse",{init:function(e){var r=this;r.x=0,r.y=0,r.pressedButtons={},r.wheelTimeOuts={};var o=function(t){r.pressedButtons[t]=!0,r.onPressed(r.x,r.y,t)},s=function(t){r.pressedButtons[t]=!1,r.onReleased(r.x,r.y,t)},u=function(e){e.preventDefault();var n=i(e);clearTimeout(r.wheelTimeOuts[n]),r.wheelTimeOuts[n]=setTimeout(function(){s(n)},1e3*t.Mouse.WHEEL_TIMEOUT),o(n)};e.addEventListener("mousemove",function(t){var n=e.getBoundingClientRect();r.x=t.pageX-n.left,r.y=t.pageY-n.top,r.onMoved(r.x,r.y)}),e.addEventListener("mousedown",function(t){o(n(t))}),e.addEventListener("mouseup",function(t){s(n(t))}),e.addEventListener("DOMMouseScroll",u),e.addEventListener("mousewheel",u)},getX:function(){return this.x},getY:function(){return this.y},getPosition:function(){return{x:this.x,y:this.y}},onPressed:function(){},onReleased:function(){},onMoved:function(){},isPressed:function(t){return!!this.pressedButtons[t]}}),t.Mouse.WHEEL_TIMEOUT=.02;var e={1:"l",2:"m",3:"r"},n=function(t){return e[t.which]},i=function(t){var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));return 1===e?"wu":"wd"}}(),function(){t.Touch=t.Class("Luv.Touch",{init:function(t){var e=this;e.fingers={},e.el=t;var r=function(t){t.preventDefault(),t.stopPropagation()};t.addEventListener("gesturestart",r),t.addEventListener("gesturechange",r),t.addEventListener("gestureend",r),t.addEventListener("touchstart",function(o){r(o);for(var s,u,a=t.getBoundingClientRect(),h=0;o.targetTouches.length>h;h++)s=o.targetTouches[h],u=i(e,s.identifier),u||(u={identifier:s.identifier,position:n(e),x:s.pageX-a.left,y:s.pageY-a.top},e.fingers[u.position]=u,e.onPressed(u.position,u.x,u.y))});var o=function(n){r(n);var o,s;t.getBoundingClientRect();for(var u=0;n.changedTouches.length>u;u++)o=n.changedTouches[u],s=i(e,o.identifier),s&&(delete e.fingers[s.position],e.onReleased(s.position,s.x,s.y))};t.addEventListener("touchend",o),t.addEventListener("touchleave",o),t.addEventListener("touchcancel",o),t.addEventListener("touchmove",function(n){r(n);for(var o,s,u=t.getBoundingClientRect(),a=0;n.targetTouches.length>a;a++)o=n.targetTouches[a],s=i(e,o.identifier),s&&(s.x=o.pageX-u.left,s.y=o.pageY-u.top,e.onMoved(s.position,s.x,s.y))})},onPressed:function(){},onReleased:function(){},onMoved:function(){},isPressed:function(t){return!!this.fingers[t]},getFinger:function(t){var e=this.fingers[t];return e&&{position:e.position,identifier:e.identifier,x:e.x,y:e.y}},getFingers:function(){for(var t,e,n=[],i=Object.keys(this.fingers).sort(),r=0;i.length>r;r++)e=i[r],t=this.fingers[e],n.push({position:e,x:t.x,y:t.y});return n},isAvailable:function(){return void 0!==window.ontouchstart}});var e=function(t){var e=Object.keys(t.fingers);return 0===e.length?0:Math.max.apply(Math,e)},n=function(t){for(var n=e(t),i=1;n>i;i++)if(!t.isPressed(i))return i;return n+1},i=function(t,e){var n=t.fingers;for(var i in n)if(n.hasOwnProperty(i)&&n[i].identifier==e)return n[i]}}(),function(){t.Media=t.Class("Luv.Media",{init:function(){this.pending=0,this.loaded=!0},isLoaded:function(){return this.loaded},getPending:function(){return this.pending},onAssetLoaded:function(){},onAssetError:function(t){throw Error("Could not load "+t)},onLoaded:function(){},newAsset:function(t){this.pending++,this.loaded=!1,clearTimeout(this.onLoadedTimeout),t.status="pending"},registerLoad:function(e){if(this.pending--,e.status="loaded",this.onAssetLoaded(e),0===this.pending){var n=this;clearTimeout(this.onLoadedTimeout),this.onLoadedTimeout=setTimeout(function(){n.loaded=!0,n.onLoaded()},t.Timer.ONLOAD_TIMEOUT)}},registerError:function(t){this.pending--,t.status="error",this.onAssetError(t)}}),t.Timer.ONLOAD_TIMEOUT=200,t.Media.Asset={isPending:function(){return"pending"==this.status},isLoaded:function(){return"loaded"==this.status},isError:function(){return"error"==this.status}}}(),function(){t.Audio=t.Class("Luv.Audio",{init:function(t){this.media=t},isAvailable:function(){return t.Audio.isAvailable()},getSupportedTypes:function(){return t.Audio.getSupportedTypes()},canPlayType:function(t){return this.supportedTypes[t.toLowerCase()]},Sound:function(){if(this.isAvailable()){var e=[this.media].concat(Array.prototype.slice.call(arguments,0));return t.Audio.Sound.apply(t.Audio.Sound,e)}return t.Audio.NullSound()}}),t.Audio.isAvailable=function(){return i},t.Audio.canPlayType=function(t){return!!n[t.toLowerCase()]},t.Audio.getSupportedTypes=function(){return Object.keys(n)};var e=document.createElement("audio"),n={},i=!!e.canPlayType;i&&(n.ogg=!!e.canPlayType('audio/ogg; codecs="vorbis"'),n.mp3=!!e.canPlayType("audio/mpeg;"),n.wav=!!e.canPlayType('audio/wav; codecs="1"'),n.m4a=!!e.canPlayType("audio/x-m4a;"),n.aac=!!e.canPlayType("audio/aac;"))}(),function(){t.Audio.Sound=t.Class("Luv.Audio.Sound",{init:function(e){var n=Array.prototype.slice.call(arguments,1);if(0===n.length)throw Error("Must provide at least one path for the Sound");if(n=n.filter(o),0===n.length)throw Error("None of the provided sound types ("+n.join(", ")+") is supported by the browser: ("+t.Audio.getSupportedTypes().join(", ")+")");var i=this;i.path=n[0],e.newAsset(i);var r=i.el=document.createElement("audio");r.preload="auto",r.addEventListener("canplaythrough",function(){i.isLoaded()||e.registerLoad(i)}),r.addEventListener("error",function(){e.registerError(i)}),r.src=i.path,r.load(),i.instances=[],i.expirationTime=t.Audio.Sound.DEFAULT_EXPIRATION_TIME},toString:function(){return'Luv.Audio.Sound("'+this.path+'")'},play:function(t){if(!this.isLoaded())throw Error("Attepted to play a non loaded sound: "+this);var e=this.getReadyInstance(t);return e.play(),e},pause:function(){this.instances.forEach(function(t){t.pause()})},stop:function(){this.instances.forEach(function(t){t.stop()})},countInstances:function(){return this.instances.length},countPlayingInstances:function(){var t=0;return this.instances.forEach(function(e){t+=e.isPlaying()?1:0}),t},getReadyInstance:function(t){var i=e(this.instances);return i||(i=n(this),this.instances.push(i)),i.reset(this.el,t),i},getExpirationTime:function(){return this.expirationTime},setExpirationTime:function(t){this.expirationTime=t}}),t.Audio.Sound.DEFAULT_EXPIRATION_TIME=3,t.Audio.Sound.include(t.Media.Asset),t.Audio.SoundMethods={setVolume:function(t){t=s(t,0,1),this.el.volume=t},getVolume:function(){return this.el.volume},setLoop:function(t){this.loop=!!t,t?this.el.loop="loop":this.el.removeAttribute("loop")},getLoop:function(){return this.loop},setSpeed:function(t){this.el.playbackRate=t},getSpeed:function(){return this.el.playbackRate},setTime:function(t){try{this.el.currentTime=t}catch(e){}},getTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration}},t.Audio.Sound.include(t.Audio.SoundMethods);var e=function(t){for(var e,n=0;t.length>n;n++)if(e=t[n],e.isReady())return e},n=function(e){return t.Audio.SoundInstance(e.el.cloneNode(!0),function(){clearTimeout(this.expirationTimeOut)},function(){var t=this;t.expirationTimeOut=setTimeout(function(){i(e,t)},1e3*e.getExpirationTime())})},i=function(t,e){var n=t.instances.indexOf(e);-1!=n&&t.instances.splice(n,1)},r=function(t){var e=t.match(/.+\.([^?]+)(\?|$)/);return e?e[1].toLowerCase():""},o=function(e){return t.Audio.canPlayType(r(e))},s=function(t,e,n){return Math.max(e,Math.min(n,Number(t)))}}(),function(){t.Audio.SoundInstance=t.Class("Luv.Audio.SoundInstance",{init:function(t,e,n){var i=this;i.el=t,i.onPlay=e,i.onStop=n,i.el.addEventListener("ended",function(){i.stop()})},reset:function(t,e){e=e||{};var n=e.volume===void 0?t.volume:e.volume,i=e.loop===void 0?!!t.loop:e.loop,r=e.speed===void 0?t.playbackRate:e.speed,o=e.time===void 0?t.currentTime:e.time,s=e.status===void 0?"ready":e.status;this.setVolume(n),this.setLoop(i),this.setSpeed(r),this.setTime(o),this.status=s},play:function(){this.el.play(),this.status="playing",this.onPlay()},pause:function(){this.isPlaying()&&(this.el.pause(),this.status="paused")},stop:function(){this.el.pause(),this.setTime(0),this.status="ready",this.onStop()},isPaused:function(){return"paused"==this.status},isReady:function(){return"ready"==this.status},isPlaying:function(){return"playing"==this.status},onPlay:function(){},onStop:function(){}}),t.Audio.SoundInstance.include(t.Audio.SoundMethods)}(),function(){t.Audio.NullSound=t.Class("Luv.Audio.NullSound");var e={},n=function(){return 0};for(var i in t.Audio.Sound.methods)t.Audio.Sound.methods.hasOwnProperty(i)&&(e[i]=n);t.Audio.NullSound.include(e,{play:function(){return t.Audio.SoundInstance(r())}});var r=function(){return{volume:1,playbackRate:1,loop:void 0,currentTime:0,play:function(){},pause:function(){},addEventListener:function(t,e){e()}}}}(),function(){t.Graphics=t.Class("Luv.Graphics",{init:function(t,e){this.el=t,this.media=e},parseColor:function(e,n,i){return t.Graphics.parseColor(e,n,i)},Canvas:function(e,n){return e=e||this.el.getAttribute("width"),n=n||this.el.getAttribute("height"),t.Graphics.Canvas(e,n)},Image:function(e){return t.Graphics.Image(this.media,e)},Sprite:function(e,n,i,r,o){return t.Graphics.Sprite(e,n,i,r,o)},SpriteSheet:function(e,n,i,r,o,s){return t.Graphics.SpriteSheet(e,n,i,r,o,s)}}),t.Graphics.parseColor=function(t,e,n){var i,r=parseInt;if(Array.isArray(t))return{r:t[0],g:t[1],b:t[2]};if("object"==typeof t)return{r:t.r,g:t.g,b:t.b};if("string"==typeof t){if(t=t.replace(/#|\s+/g,""),i=/^([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))return{r:r(i[1],16),g:r(i[2],16),b:r(i[3],16)};if(i=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t))return{r:17*r(i[1],16),g:17*r(i[2],16),b:17*r(i[3],16)};if(i=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(t))return{r:r(i[1],10),g:r(i[2],10),b:r(i[3],10)}}return{r:t,g:e,b:n}}}(),function(){t.Graphics.Animation=t.Class("Luv.Graphics.Animation",{init:function(t,n){if(!Array.isArray(t))throw Error("Array of sprites needed. Got "+t);if(0===t.length)throw Error("No sprites where provided. Must provide at least one");this.sprites=t.slice(0),this.time=0,this.index=0,this.durations=i(t.length,n),this.intervals=e(this.durations),this.loopDuration=this.intervals[this.intervals.length-1]},update:function(t){var e;this.time+=t,e=Math.floor(this.time/this.loopDuration),this.time-=this.loopDuration*e,0!==e&&this.onLoopEnded(e),this.index=n(this.intervals,this.time)},gotoSprite:function(t){this.index=t,this.time=this.intervals[t]},getCurrentSprite:function(){return this.sprites[this.index]},onLoopEnded:function(){}}),"getWidth getHeight getDimensions getCenter drawInCanvas".split(" ").forEach(function(e){t.Graphics.Animation.methods[e]=function(){var t=this.getCurrentSprite();return t[e].apply(t,arguments)}});var e=function(t){for(var e=[0],n=0,i=0;t.length>i;i++)n+=t[i],e.push(n);return e},n=function(t,e){for(var n=t.length-2,i=0,r=0;n>=i;)if(r=Math.floor((i+n)/2),e>=t[r+1])i=r+1;else{if(!(t[r]>e))break;n=r-1}return r},i=function(t,e){var n,i,o,s,u=[];if(Array.isArray(e))u=e.slice(0);else if("object"==typeof e){u.length=t;for(n in e)if(e.hasOwnProperty(n))for(o=r(n),s=Number(e[n]),i=0;o.length>i;i++)u[o[i]]=s}else for(e=Number(e),i=0;t>i;i++)u.push(e);if(u.length!=t)throw Error("The durations table length should be "+t+", but it is "+u.length);for(i=0;u.length>i;i++){if(u[i]===void 0)throw Error("Missing delay for sprite "+i);if(isNaN(u[i]))throw Error("Could not parse the delay for sprite "+i)}return u},r=function(t){var e,n,i,r,o;if("string"!=typeof t)throw Error("Unknown range type (must be integer or string in the form 'start-end'): "+t);if(e=t.match(/^(\d+)-(\d+)$/))if(n=[],i=Number(e[1]),r=Number(e[2]),r>i)for(o=i;r>=o;o++)n.push(o);else for(o=i;o>=r;o--)n.push(o);else n=[Number(t)];return n}}(),function(){t.Graphics.Canvas=t.Class("Luv.Graphics.Canvas",{init:function(t,e){var n;t.getAttribute?(n=t,t=n.getAttribute("width"),e=n.getAttribute("height")):(n=document.createElement("canvas"),n.setAttribute("width",t),n.setAttribute("height",e)),this.el=n,this.ctx=n.getContext("2d"),this.color={},this.backgroundColor={},this.setBackgroundColor(0,0,0),this.setColor(255,255,255),this.setLineCap("butt"),this.setLineWidth(1),this.setImageSmoothing(!0),this.setAlpha(1)},clear:function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.globalAlpha=1,this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.getWidth(),this.getHeight()),this.ctx.restore()},print:function(t,e,n){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(t,e,n)},line:function(){var t=Array.isArray(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),r(this,"luv.graphics.line",4,t),u(this,d.STROKE)},strokeRectangle:function(t,e,n,i){a(this,d.STROKE,t,e,n,i)},fillRectangle:function(t,e,n,i){a(this,d.FILL,t,e,n,i)},strokePolygon:function(){h(this,d.STROKE,arguments)},fillPolygon:function(){h(this,d.FILL,arguments)},strokeCircle:function(t,e,n){f(this,d.STROKE,t,e,n)},fillCircle:function(t,e,n){f(this,d.FILL,t,e,n)},strokeArc:function(t,e,n,i,r){c(this,d.STROKE,t,e,n,i,r)},fillArc:function(t,e,n,i,r){c(this,d.FILL,t,e,n,i,r)},draw:function(t,e,n,i,r,s,u,a){var h=this.ctx;e=e||0,n=n||0,r=r||1,s=s||1,u=u||0,a=a||0,i=o(i||0),0!==i||1!==r||1!==s||0!==u||0!==a?(h.save(),h.translate(e,n),h.translate(u,a),h.rotate(i),h.scale(r,s),h.translate(-u,-a),t.drawInCanvas(this,0,0),h.restore()):t.drawInCanvas(this,e,n)},drawCentered:function(t,e,n,i,r,o){var s=t.getCenter();this.draw(t,e-s.x,n-s.y,i,r,o,s.x,s.y)},drawInCanvas:function(t,e,n){t.ctx.drawImage(this.el,e,n)},translate:function(t,e){this.ctx.translate(t,e)},scale:function(t,e){this.ctx.scale(t,e)},rotate:function(t){this.ctx.rotate(t)},push:function(){this.ctx.save()},pop:function(){this.ctx.restore()},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimensions:function(t,e){this.el.setAttribute("width",t),this.el.setAttribute("height",e)},getWidth:function(){return Number(this.el.getAttribute("width"))},getHeight:function(){return Number(this.el.getAttribute("height"))},getCenter:function(){return{x:this.getWidth()/2,y:this.getHeight()/2}},setColor:function(t,e,i){n(this,"color",t,e,i)},getColor:function(){return i(this.color)},setBackgroundColor:function(t,e,i){n(this,"backgroundColor",t,e,i)},getBackgroundColor:function(){return i(this.backgroundColor)},setAlpha:function(t){this.alpha=l(t,0,1),this.ctx.globalAlpha=this.alpha},getAlpha:function(){return this.alpha},setLineWidth:function(t){this.lineWidth=t,this.ctx.lineWidth=t},getLineWidth:function(){return this.lineWidth},setLineCap:function(t){if("butt"!=t&&"round"!=t&&"square"!=t)throw Error("Line cap must be either 'butt', 'round' or 'square' (was: "+t+")");this.ctx.lineCap=t,this.lineCap=this.ctx.lineCap},getLineCap:function(){return this.lineCap},setImageSmoothing:function(t){this.imageSmoothing=t=!!t,s(this.ctx,t)},getImageSmoothing:function(){return this.imageSmoothing}});var e=2*Math.PI,n=function(e,n,i,r,o){var s=e[n],u=t.Graphics.parseColor(i,r,o);t.extend(s,u),e[n+"Style"]="rgb("+[s.r,s.g,s.b].join()+")"},i=function(t){return{r:t.r,g:t.g,b:t.b}},r=function(t,e,n,i){if(n>i.length)throw Error(e+" requires at least 4 parameters");if(1==i.length%2)throw Error(e+" requires an even number of parameters");t.ctx.moveTo(i[0],i[1]);for(var r=2;i.length>r;r+=2)t.ctx.lineTo(i[r],i[r+1]);t.ctx.stroke()},o=function(t){return t%=e,0>t?t+e:t},s=function(t,e){t.webkitImageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.imageSmoothingEnabled=e},u=function(t,e){switch(e){case d.FILL:t.ctx.fillStyle=t.colorStyle,t.ctx.fill();break;case d.STROKE:t.ctx.strokeStyle=t.colorStyle,t.ctx.stroke();break;default:throw Error("Invalid mode: ["+e+']. Should be "fill" or "line"')}},a=function(t,e,n,i,r,o){t.ctx.beginPath(),t.ctx.rect(n,i,r,o),u(t,e),t.ctx.closePath()},h=function(t,e,n){var i=Array.isArray(n[0])?n[0]:Array.prototype.slice.call(n,0);t.ctx.beginPath(),r(t,"luv.Graphics.Canvas.polygon",6,i),u(t,e),t.ctx.closePath()},c=function(t,e,n,i,r,o,s){t.ctx.beginPath(),t.ctx.arc(n,i,r,o,s,!1),u(t,e)},f=function(t,n,i,r,o){c(t,n,i,r,o,0,e),t.ctx.closePath()},d={STROKE:1,FILL:2},l=function(t,e,n){return Math.max(e,Math.min(n,Number(t)))}}(),function(){t.Graphics.Image=t.Class("Luv.Graphics.Image",{init:function(t,e){var n=this;n.path=e,t.newAsset(n);var i=new Image;n.source=i,i.addEventListener("load",function(){t.registerLoad(n)}),i.addEventListener("error",function(){t.registerError(n)}),i.src=e},toString:function(){return'instance of Luv.Graphics.Image("'+this.path+'")'},getWidth:function(){return this.source.width},getHeight:function(){return this.source.height},getDimensions:function(){return{width:this.source.width,height:this.source.height}},getCenter:function(){return{x:this.source.width/2,y:this.source.height/2}},drawInCanvas:function(t,e,n){if(!this.isLoaded())throw Error("Attepted to draw a non loaded image: "+this);t.ctx.drawImage(this.source,e,n)}}),t.Graphics.Image.include(t.Media.Asset)}(),function(){t.Graphics.Sprite=t.Class("Luv.Graphics.Sprite",{init:function(t,e,n,i,r){this.image=t,this.left=e,this.top=n,this.width=i,this.height=r},toString:function(){return["instance of Luv.Graphics.Sprite(",this.image,", ",this.left,", ",this.top,", ",this.width,", ",this.height,")"].join("")},getImage:function(){return this.image},getWidth:function(){return this.width},getHeight:function(){return this.height},getDimensions:function(){return{width:this.width,height:this.height}},getCenter:function(){return{x:this.width/2,y:this.height/2}},getBoundingBox:function(){return{left:this.left,top:this.top,width:this.width,height:this.height}},drawInCanvas:function(t,e,n){if(!this.image.isLoaded())throw Error("Attepted to draw a prite of a non loaded image: "+this);t.ctx.drawImage(this.image.source,this.left,this.top,this.width,this.height,e,n,this.width,this.height)}})}(),function(){t.Graphics.SpriteSheet=t.Class("Luv.Graphics.SpriteSheet",{init:function(t,e,n,i,r,o){this.image=t,this.width=e,this.height=n,this.left=i||0,this.top=r||0,this.border=o||0},getSprites:function(){for(var t,n,i=[],r=0;arguments.length>r;r+=2){t=e(arguments[r]),n=e(arguments[r+1]);for(var o=0;n.length>o;o++)for(var s=0;t.length>s;s++)i.push(this.Sprite(t[s],n[o]))}return i},Sprite:function(e,n){return t.Graphics.Sprite(this.image,this.left+this.width*e+this.border*(e+1),this.top+this.height*n+this.border*(n+1),this.width,this.height)},Animation:function(e,n){var i=this.getSprites.apply(this,e);return t.Graphics.Animation(i,n)}});var e=function(t){if("number"==typeof t)return[t];if("string"==typeof t){var e=t.split("-");if(2!=e.length)throw Error("Could not parse from '"+t+"'. Must be of the form 'start-end'");var n,i=[],r=Number(e[0]),o=Number(e[1]);if(o>r)for(n=r;o>=n;n++)i.push(n);else for(n=r;n>=o;n--)i.push(n);return i}throw Error("Ranges must be integers or strings of the form 'start-end'. Got "+t)}}(),t});