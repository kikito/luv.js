/*! luv 0.0.1 (2013-04-18) - https://github.com/kikito/luv.js */
/*! Minimal HTML5 game development lib */
/*! Enrique Garcia Cota */
window.Luv=function(){var t=function(t){for(var n,i=1;arguments.length>i;i++){n=arguments[i];for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}return t},n=function(t,n){n=Array.isArray(n)?n:[n];for(var i=0;n.length>i;i++)delete t[n[i]];return t},i=Object.create,e={toString:function(){return"instance of "+this.getClass().getName()}},r=t(function(){return i(e)},{init:function(){},getName:function(){return"Base"},toString:function(){return"Base"},getSuper:function(){return null},methods:e,include:function(){return t.apply(this,[this.methods].concat(Array.prototype.slice.call(arguments,0)))},subclass:function(e,r){r=r||{};var o=this,u=function(){return e},s=n(t(i(o.methods),r),"init"),a=t(function(){var t=i(s);return a.init.apply(t,arguments),t},o,r,{getName:u,toString:u,getSuper:function(){return o},methods:s});return s.getClass=function(){return a},a}});e.getClass=function(){return r};var o=r.subclass("Luv",{init:function(t){t=u(t);var n=this;if(n.el=t.el,n.el.tabIndex=1,"load update draw run onResize onBlur onFocus".split(" ").forEach(function(i){t[i]&&(n[i]=t[i])}),n.media=o.Media(),n.timer=o.Timer(),n.keyboard=o.Keyboard(n.el),n.mouse=o.Mouse(n.el),n.audio=o.Audio(n.media),n.graphics=o.Graphics(n.el,n.media),t.fullWindow){var i=function(){n.graphics.setDimensions(window.innerWidth,window.innerHeight),n.onResize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",i,!1),window.addEventListener("orientationChange",i,!1),n.el.focus()}n.el.addEventListener("blur",function(){n.onBlur()}),n.el.addEventListener("focus",function(){n.onFocus()})},load:function(){},draw:function(){},update:function(){},run:function(){var t=this;t.load();var n=function(){t.timer.step();var i=t.timer.getDeltaTime();t.update(i),t.graphics.setCanvas(),t.graphics.clear(),t.draw(),t.timer.nextFrame(n)};t.timer.nextFrame(n)},onResize:function(){},onBlur:function(){},onFocus:function(){}});o.Class=function(t,n){return r.subclass(t,n)},o.Base=r,o.extend=t;var u=function(t){t=t||{};var n=t.el,i=t.id,e=t.width,r=t.height,o=document.getElementsByTagName("body")[0],u=document.getElementsByTagName("html")[0],s="width: 100%; height: 100%; margin: 0; overflow: hidden;";return!n&&i&&(n=document.getElementById(i)),n?(!e&&n.getAttribute("width")&&(e=Number(n.getAttribute("width"))),!r&&n.getAttribute("height")&&(r=Number(n.getAttribute("height")))):(n=document.createElement("canvas"),o.appendChild(n)),t.fullWindow?(u.style.cssText=o.style.cssText=s,e=window.innerWidth,r=window.innerHeight):(e=e||800,r=r||600),n.setAttribute("width",e),n.setAttribute("height",r),t.el=n,t.width=e,t.height=r,t};return o}(),function(){Luv.Timer=Luv.Class("Luv.Timer",{init:function(){this.microTime=n.now(),this.deltaTime=0,this.deltaTimeLimit=Luv.Timer.DEFAULT_DELTA_TIME_LIMIT,this.events={},this.maxEventId=0},step:function(){this.update((n.now()-this.microTime)/1e3)},update:function(t){this.deltaTime=Math.max(0,Math.min(this.deltaTimeLimit,t)),this.microTime+=1e3*t;for(var n in this.events)this.events.hasOwnProperty(n)&&this.events[n].update(t)&&delete this.events[n]},setDeltaTimeLimit:function(t){this.deltaTimeLimit=t},getDeltaTimeLimit:function(){return this.deltaTimeLimit},getDeltaTime:function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},getFPS:function(){return 0===this.deltaTime?0:1/this.deltaTime},nextFrame:function(t){e(t)},after:function(n,i,e){return t(this,Luv.Timer.AfterEvent(n,i,e))},every:function(n,i,e){return t(this,Luv.Timer.EveryEvent(n,i,e))},clear:function(t){return this.events[t]?(delete this.events[t],!0):!1}}),Luv.Timer.DEFAULT_DELTA_TIME_LIMIT=.25;var t=function(t,n){var i=t.maxEventId++;return t.events[i]=n,i},n=window.performance||{};n.now=n.now||n.msNow||n.mozNow||n.webkitNow||Date.now;var i=0,e=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(t){var e=n.now(),r=Math.max(0,16-(e-i)),o=setTimeout(function(){t(e+r)},r);return i=e+r,o}}(),function(){Luv.Timer.AfterEvent=Luv.Class("Luv.Timer.AfterEvent",{init:function(t,n,i){this.timeRunning=0,this.timeToCall=t,this.callback=n,this.context=i},update:function(t){this.timeRunning+=t;var n=this.timeRunning-this.timeToCall;return n>=0?(this.callback.call(this.context,n),!0):!1}})}(),function(){Luv.Timer.EveryEvent=Luv.Class("Luv.Timer.EveryEvent",{init:function(t,n,i){this.timeRunning=0,this.timeToCall=t,this.callback=n,this.context=i},update:function(t){if(this.timeRunning+=t,this.timeToCall>0)for(;this.timeRunning>=this.timeToCall;)this.callback.call(this.context,this.timeRunning-this.timeToCall),this.timeRunning-=this.timeToCall;else this.callback.call(this.context,t);return!1}})}(),function(){Luv.Timer.Tween=Luv.Class("Luv.Timer.Tween",{init:function(t,n,i,e){q(n,i,[]),e=e||{},this.easing=Q(e.easing),this.step=e.step||this.step,this.onFinished=e.onFinished||this.onFinished,this.runningTime=0,this.finished=!1,this.timeToFinish=t,this.subject=n,this.from=z(n,i),this.to=z(i)},update:function(t){return this.runningTime>=this.timeToFinish?void 0:(this.runningTime+=t,this.runningTime>=this.timeToFinish&&(this.runningTime=this.timeToFinish,this.onFinished(),this.finished=!0),this.step(K(this,this.from,this.to)),this.finished)},step:function(t){this.subject=U(this.subject,t)},onFinished:function(){},isFinished:function(){return!!this.finished}});var t=function(t,n,i,e){return i*t/e+n},n=function(t,n,i,e){return i*Math.pow(t/e,2)+n},i=function(t,n,i,e){return t/=e,-i*t*(t-2)+n},e=function(t,n,i,e){return t=2*(t/e),1>t?i/2*Math.pow(t,2)+n:-i/2*((t-1)*(t-3)-1)+n},r=function(t,e,r,o){return o/2>t?i(2*t,e,r/2,o):n(2*t-o,e+r/2,r/2,o)},o=function(t,n,i,e){return i*Math.pow(t/e,3)+n},u=function(t,n,i,e){return i*(Math.pow(t/e-1,3)+1)+n},a=function(t,n,i,e){return t=2*(t/e),1>t?i/2*t*t*t+n:(t-=2,i/2*(t*t*t+2)+n)},h=function(t,n,i,e){return e/2>t?u(2*t,n,i/2,e):o(2*t-e,n+i/2,i/2,e)},c=function(t,n,i,e){return i*Math.pow(t/e,4)+n},f=function(t,n,i,e){return-i*(Math.pow(t/e-1,4)-1)+n},l=function(t,n,i,e){return t=2*(t/e),1>t?i/2*Math.pow(t,4)+n:-i/2*(Math.pow(t-2,4)-2)+n},d=function(t,n,i,e){return e/2>t?f(2*t,n,i/2,e):c(2*t-e,n+i/2,i/2,e)},p=function(t,n,i,e){return i*Math.pow(t/e,5)+n},g=function(t,n,i,e){return i*(Math.pow(t/e-1,5)+1)+n},m=function(t,n,i,e){return t=2*(t/e),1>t?i/2*Math.pow(t,5)+n:i/2*(Math.pow(t-2,5)+2)+n},v=function(t,n,i,e){return e/2>t?g(2*t,n,i/2,e):p(2*t-e,n+i/2,i/2,e)},w=function(t,n,i,e){return-i*Math.cos(t/e*(Math.PI/2))+i+n},L=function(t,n,i,e){return i*Math.sin(t/e*(Math.PI/2))+n},y=function(t,n,i,e){return-i/2*(Math.cos(Math.PI*t/e)-1)+n},T=function(t,n,i,e){return e/2>t?L(2*t,n,i/2,e):w(2*t-e,n+i/2,i/2,e)},b=function(t,n,i,e){return 0===t?n:i*Math.pow(2,10*(t/e-1))+n-.001*i},A=function(t,n,i,e){return t==e?n+i:1.001*i*(-Math.pow(2,-10*t/e)+1)+n},E=function(t,n,i,e){return 0===t?n:t==e?n+i:(t=2*(t/e),1>t?i/2*Math.pow(2,10*(t-1))+n-5e-4*i:1.0005*(i/2)*(-Math.pow(2,-10*(t-1))+2)+n)},S=function(t,n,i,e){return e/2>t?A(2*t,n,i/2,e):b(2*t-e,n+i/2,i/2,e)},C=function(t,n,i,e){return-i*(Math.sqrt(1-Math.pow(t/e,2))-1)+n},x=function(t,n,i,e){return i*Math.sqrt(1-Math.pow(t/e-1,2))+n},M=function(t,n,i,e){return t=2*(t/e),1>t?-i/2*(Math.sqrt(1-t*t)-1)+n:(t-=2,i/2*(Math.sqrt(1-t*t)+1)+n)},I=function(t,n,i,e){return e/2>t?x(2*t,n,i/2,e):C(2*t-e,n+i/2,i/2,e)},k=function(t,n,i,e){return t=t===void 0?.3*e:t,n=n||0,Math.abs(i)>n?(n=i,s=t/4):s=t/(2*Math.PI)*Math.asin(i/n),[t,n,s]},P=function(t,n,i,e,r,o){if(0===t)return n;if(t/=e,1==t)return n+i;var u=k(o,r,i,e),s=u[2];return o=u[0],r=u[1],t-=1,-(r*Math.pow(2,10*t)*Math.sin((t*e-s)*2*Math.PI/o))+n},O=function(t,n,i,e,r,o){if(0===t)return n;if(t/=e,1==t)return n+i;var u=k(o,r,i,e),s=u[2];return o=u[0],r=u[1],r*Math.pow(2,-10*t)*Math.sin((t*e-s)*2*Math.PI/o)+i+n},R=function(t,n,i,e,r,o){if(0===t)return n;if(t/=e,1==t)return n+i;var u=k(o,r,i,e),s=u[2];return o=u[0],r=u[1],t-=1,0>t?-.5*r*Math.pow(2,10*t)*Math.sin((t*e-s)*2*Math.PI/o)+n:.5*r*Math.pow(2,-10*t)*Math.sin((t*e-s)*2*Math.PI/o)+i+n},D=function(t,n,i,e,r,o){return e/2>t?O(2*t,n,i/2,e,r,o):P(2*t-e,n+i/2,i/2,e,r,o)},N=function(t,n,i,e,r){return r=r||1.70158,t/=e,i*t*t*((r+1)*t-r)+n},F=function(t,n,i,e,r){return r=r||1.70158,t=t/e-1,i*(t*t*((r+1)*t+r)+1)+n},B=function(t,n,i,e,r){return r=1.525*(r||1.70158),t=2*(t/e),1>t?i/2*t*t*((r+1)*t-r)+n:(t-=2,i/2*(t*t*((r+1)*t+r)+2)+n)},G=function(t,n,i,e,r){return e/2>t?F(2*t,n,i/2,e,r):N(2*t-e,n+i/2,i/2,e,r)},W=function(t,n,i,e){return t/=e,1/2.75>t?i*7.5625*t*t+n:2/2.75>t?(t-=1.5/2.75,i*(7.5625*t*t+.75)+n):2.5/2.75>t?(t-=2.25/2.75,i*(7.5625*t*t+.9375)+n):(t-=2.625/2.75,i*(7.5625*t*t+.984375)+n)},j=function(t,n,i,e){return i-W(e-t,0,i,e)+n},H=function(t,n,i,e){return e/2>t?.5*j(2*t,0,i,e)+n:.5*W(2*t-e,0,i,e)+.5*i+n},_=function(t,n,i,e){return e/2>t?W(2*t,n,i/2,e):j(2*t-e,n+i/2,i/2,e)};Luv.Timer.Tween.easing={linear:t,inQuad:n,outQuad:i,inOutQuad:e,outInQuad:r,inCubic:o,outCubic:u,inOutCubic:a,outInCubic:h,inQuart:c,outQuart:f,inOutQuart:l,outInQuart:d,inQuint:p,outQuint:g,inOutQuint:m,outInQuint:v,inSine:w,outSine:L,inOutSine:y,outInSine:T,inExpo:b,outExpo:A,inOutExpo:E,outInExpo:S,inCirc:C,outCirc:x,inOutCirc:M,outInCirc:I,inElastic:P,outElastic:O,inOutElastic:R,outInElastic:D,inBack:N,outBack:F,inOutBack:B,outInBack:G,inBounce:j,outBounce:W,inOutBounce:H,outInBounce:_};var q=function(t,n,i){var e,r;for(var o in n)if(n.hasOwnProperty(o))if(e=typeof n[o],r=i.slice(0),r.push(o+""),"number"===e){if("number"!=typeof t[o])throw Error("Parameter '"+r.join("/")+"' is missing from 'from' or isn't a number")}else{if("object"!==e)throw Error("Parameter '"+r.join("/")+"' must be a number or string, was "+n[o]);q(t[o],n[o],r)}},K=function(t,n,i){var e;if("object"==typeof i){e=Array.isArray(i)?[]:{};for(var r in i)i.hasOwnProperty(r)&&(e[r]=K(t,n[r],i[r]))}else e=t.easing(t.runningTime,n,i-n,t.timeToFinish);return e},Q=function(t){return t=t||"linear","string"==typeof t?Luv.Timer.Tween.easing[t]:t},U=function(t,n,i){if(i=i||n,"object"==typeof n){t=t||(Array.isArray(n)?[]:{});for(var e in n)n.hasOwnProperty(e)&&(t[e]=U(t[e],n[e],i[e]))}else t=n;return t},z=function(t,n){return U(null,t,n)}}(),function(){Luv.Keyboard=Luv.Class("Luv.Keyboard",{init:function(t){var n=this;return n.keysDown={},n.el=t,t.addEventListener("keydown",function(t){t.preventDefault(),t.stopPropagation();var i=e(t);n.keysDown[i]=!0,n.onPressed(i,t.which)}),t.addEventListener("keyup",function(t){t.preventDefault(),t.stopPropagation();var i=e(t);n.keysDown[i]=!1,n.onReleased(i,t.which)}),n},onPressed:function(){},onReleased:function(){},isDown:function(t){return!!this.keysDown[t]}});var t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",45:"insert",46:"delete",37:"left",38:"up",39:"right",40:"down",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},i={16:"rshift",17:"rctrl",18:"ralt"},e=function(e){var r,o=e.which;return r=e.keyLocation&&e.keyLocation>1?i[o]:e.shiftKey?n[o]||t[o]:t[o],r===void 0&&(r=String.fromCharCode(o),e.shiftKey&&(r=r.toUpperCase())),r}}(),function(){Luv.Mouse=Luv.Class("Luv.Mouse",{init:function(t){var e=this;e.x=0,e.y=0,e.pressedButtons={},e.wheelTimeOuts={};var r=function(t){e.pressedButtons[t]=!0,e.onPressed(e.x,e.y,t)},o=function(t){e.pressedButtons[t]=!1,e.onReleased(e.x,e.y,t)},u=function(t){t.preventDefault();var n=i(t);clearTimeout(e.wheelTimeOuts[n]),e.wheelTimeOuts[n]=setTimeout(function(){o(n)},1e3*Luv.Mouse.WHEEL_TIMEOUT),r(n)};t.addEventListener("mousemove",function(n){var i=t.getBoundingClientRect();e.x=n.pageX-i.left,e.y=n.pageY-i.top}),t.addEventListener("mousedown",function(t){r(n(t))}),t.addEventListener("mouseup",function(t){o(n(t))}),t.addEventListener("DOMMouseScroll",u),t.addEventListener("mousewheel",u)},getX:function(){return this.x},getY:function(){return this.y},getPosition:function(){return{x:this.x,y:this.y}},onPressed:function(){},onReleased:function(){},isPressed:function(t){return!!this.pressedButtons[t]}}),Luv.Mouse.WHEEL_TIMEOUT=.02;var t={1:"l",2:"m",3:"r"},n=function(n){return t[n.which]},i=function(t){var n=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));return 1===n?"wu":"wd"}}(),function(){Luv.Media=Luv.Class("Luv.Media",{init:function(){this.pending=0,this.loaded=!0},isLoaded:function(){return this.loaded},getPending:function(){return this.pending},onAssetLoaded:function(){},onAssetError:function(t){throw Error("Could not load "+t)},onLoaded:function(){},newAsset:function(t){this.pending++,this.loaded=!1,clearTimeout(this.onLoadedTimeout),t.status="pending"},registerLoad:function(t){if(this.pending--,t.status="loaded",this.onAssetLoaded(t),0===this.pending){var n=this;clearTimeout(this.onLoadedTimeout),this.onLoadedTimeout=setTimeout(function(){n.loaded=!0,n.onLoaded()},Luv.Timer.ONLOAD_TIMEOUT)}},registerError:function(t){this.pending--,t.status="error",this.onAssetError(t)}}),Luv.Timer.ONLOAD_TIMEOUT=200,Luv.Media.Asset={isPending:function(){return"pending"==this.status},isLoaded:function(){return"loaded"==this.status},isError:function(){return"error"==this.status}}}(),function(){Luv.Audio=Luv.Class("Luv.Audio",{init:function(t){this.media=t},isAvailable:function(){return Luv.Audio.isAvailable()},getSupportedTypes:function(){return Luv.Audio.getSupportedTypes()},canPlayType:function(t){return this.supportedTypes[t.toLowerCase()]},Sound:function(){if(this.isAvailable()){var t=[this.media].concat(Array.prototype.slice.call(arguments,0));return Luv.Audio.Sound.apply(Luv.Audio.Sound,t)}return Luv.Audio.NullSound()}}),Luv.Audio.isAvailable=function(){return i},Luv.Audio.canPlayType=function(t){return!!n[t.toLowerCase()]},Luv.Audio.getSupportedTypes=function(){return Object.keys(n)};var t=document.createElement("audio"),n={},i=!!t.canPlayType;i&&(n.ogg=!!t.canPlayType('audio/ogg; codecs="vorbis"'),n.mp3=!!t.canPlayType("audio/mpeg;"),n.wav=!!t.canPlayType('audio/wav; codecs="1"'),n.m4a=!!t.canPlayType("audio/x-m4a;"),n.aac=!!t.canPlayType("audio/aac;"))}(),function(){Luv.Audio.Sound=Luv.Class("Luv.Audio.Sound",{init:function(t){var n=Array.prototype.slice.call(arguments,1);if(0===n.length)throw Error("Must provide at least one path for the Sound");if(n=n.filter(r),0===n.length)throw Error("None of the provided sound types ("+n.join(", ")+") is supported by the browser: ("+Luv.Audio.getSupportedTypes().join(", ")+")");var i=this;i.path=n[0],t.newAsset(i);var e=i.el=document.createElement("audio");e.preload="auto",e.addEventListener("canplaythrough",function(){i.isLoaded()||t.registerLoad(i)}),e.addEventListener("error",function(){t.registerError(i)}),e.src=i.path,e.load(),i.instances=[],i.expirationTime=Luv.Audio.Sound.DEFAULT_EXPIRATION_TIME},toString:function(){return'Luv.Audio.Sound("'+this.path+'")'},play:function(t){if(!this.isLoaded())throw Error("Attepted to play a non loaded sound: "+this);var n=this.getReadyInstance(t);return n.play(),n},pause:function(){this.instances.forEach(function(t){t.pause()})},stop:function(){this.instances.forEach(function(t){t.stop()})},countInstances:function(){return this.instances.length},countPlayingInstances:function(){var t=0;return this.instances.forEach(function(n){t+=n.isPlaying()?1:0}),t},getReadyInstance:function(i){var e=t(this.instances);return e||(e=n(this),this.instances.push(e)),e.reset(this.el,i),e},getExpirationTime:function(){return this.expirationTime},setExpirationTime:function(t){this.expirationTime=t}}),Luv.Audio.Sound.DEFAULT_EXPIRATION_TIME=3,Luv.Audio.Sound.include(Luv.Media.Asset),Luv.Audio.SoundMethods={setVolume:function(t){t=o(t,0,1),this.el.volume=t},getVolume:function(){return this.el.volume},setLoop:function(t){this.loop=!!t,t?this.el.loop="loop":this.el.removeAttribute("loop")},getLoop:function(){return this.loop},setSpeed:function(t){this.el.playbackRate=t},getSpeed:function(){return this.el.playbackRate},setTime:function(t){try{this.el.currentTime=t}catch(n){}},getTime:function(){return this.el.currentTime},getDuration:function(){return this.el.duration}},Luv.Audio.Sound.include(Luv.Audio.SoundMethods);var t=function(t){for(var n,i=0;t.length>i;i++)if(n=t[i],n.isReady())return n},n=function(t){return Luv.Audio.SoundInstance(t.el.cloneNode(!0),function(){clearTimeout(this.expirationTimeOut)},function(){var n=this;n.expirationTimeOut=setTimeout(function(){i(t,n)},1e3*t.getExpirationTime())})},i=function(t,n){var i=t.instances.indexOf(n);-1!=i&&t.instances.splice(i,1)},e=function(t){var n=t.match(/.+\.([^?]+)(\?|$)/);return n?n[1].toLowerCase():""},r=function(t){return Luv.Audio.canPlayType(e(t))},o=function(t,n,i){return Math.max(n,Math.min(i,Number(t)))}}(),function(){Luv.Audio.SoundInstance=Luv.Class("Luv.Audio.SoundInstance",{init:function(t,n,i){var e=this;e.el=t,e.onPlay=n,e.onStop=i,e.el.addEventListener("ended",function(){e.stop()})},reset:function(t,n){n=n||{};var i=n.volume===void 0?t.volume:n.volume,e=n.loop===void 0?!!t.loop:n.loop,r=n.speed===void 0?t.playbackRate:n.speed,o=n.time===void 0?t.currentTime:n.time,u=n.status===void 0?"ready":n.status;this.setVolume(i),this.setLoop(e),this.setSpeed(r),this.setTime(o),this.status=u},play:function(){this.el.play(),this.status="playing",this.onPlay()},pause:function(){this.isPlaying()&&(this.el.pause(),this.status="paused")},stop:function(){this.el.pause(),this.setTime(0),this.status="ready",this.onStop()},isPaused:function(){return"paused"==this.status},isReady:function(){return"ready"==this.status},isPlaying:function(){return"playing"==this.status},onPlay:function(){},onStop:function(){}}),Luv.Audio.SoundInstance.include(Luv.Audio.SoundMethods)}(),function(){Luv.Audio.NullSound=Luv.Class("Luv.Audio.NullSound");var t={},n=function(){return 0};for(var i in Luv.Audio.Sound.methods)Luv.Audio.Sound.methods.hasOwnProperty(i)&&(t[i]=n);Luv.Audio.NullSound.include(t,{play:function(){return Luv.Audio.SoundInstance(e())}});var e=function(){return{volume:1,playbackRate:1,loop:void 0,currentTime:0,play:function(){},pause:function(){},addEventListener:function(t,n){n()}}}}(),function(){Luv.Graphics=Luv.Class("Luv.Graphics",{init:function(t,n){this.el=t,this.media=n,this.color={},this.backgroundColor={},this.alpha=1,this.lineCap="butt",this.lineWidth=1,this.imageSmoothing=!0;var i=this.getDimensions();this.defaultCanvas=this.Canvas(i.width,i.height),this.defaultCanvas.el=t,this.setCanvas(),this.setBackgroundColor(0,0,0),this.setColor(255,255,255),this.setAlpha(1)},setCanvas:function(t){t=t||this.defaultCanvas,this.canvas=t,this.el=t.el,this.ctx=t.getContext(),o(this,this.ctx)},getCanvas:function(){return this.canvas},clear:function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.getWidth(),this.getHeight()),this.ctx.restore()},setColor:function(t,i,e){n(this,"color",t,i,e)},getColor:function(){return i(this.color)},setAlpha:function(t){this.alpha=p(t,0,1),this.ctx.globalAlpha=this.alpha},getAlpha:function(){return this.alpha},setBackgroundColor:function(t,i,e){n(this,"backgroundColor",t,i,e)},getBackgroundColor:function(){return i(this.backgroundColor)},getWidth:function(){return Number(this.el.getAttribute("width"))},getHeight:function(){return Number(this.el.getAttribute("height"))},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimensions:function(t,n){this.el.setAttribute("width",t),this.el.setAttribute("height",n)},setLineWidth:function(t){this.lineWidth=t,this.ctx.lineWidth=t},getLineWidth:function(){return this.lineWidth},setLineCap:function(t){if("butt"!=t&&"round"!=t&&"square"!=t)throw Error("Line cap must be either 'butt', 'round' or 'square' (was: "+t+")");this.ctx.lineCap=t,this.lineCap=this.ctx.lineCap},getLineCap:function(){return this.lineCap},setImageSmoothing:function(t){this.imageSmoothing=t=!!t,u(this.ctx,t)},getImageSmoothing:function(){return this.imageSmoothing},print:function(t,n,i){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(t,n,i)},line:function(){var t=Array.isArray(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),e(this,"luv.graphics.line",4,t),s(this,l.STROKE)},strokeRectangle:function(t,n,i,e){a(this,l.STROKE,t,n,i,e)},fillRectangle:function(t,n,i,e){a(this,l.FILL,t,n,i,e)},strokePolygon:function(){h(this,l.STROKE,arguments)},fillPolygon:function(){h(this,l.FILL,arguments)},strokeCircle:function(t,n,i){f(this,l.STROKE,t,n,i)},fillCircle:function(t,n,i){f(this,l.FILL,t,n,i)},strokeArc:function(t,n,i,e,r){c(this,l.STROKE,t,n,i,e,r)},fillArc:function(t,n,i,e,r){c(this,l.FILL,t,n,i,e,r)},draw:function(t,n,i,e,o,u,s,a){var h=this.ctx;n=d(n,0),i=d(i,0),e=r(d(e,0)),o=d(o,1),u=d(u,1),s=d(s,0),a=d(a,0),0!==e||1!==o||1!==u||0!==s||0!==a?(h.save(),h.translate(n,i),h.translate(s,a),h.rotate(e),h.scale(o,u),h.translate(-s,-a),t.draw(h,0,0),h.restore()):t.draw(h,n,i)},drawCentered:function(t,n,i,e,r,o){var u=t.getCenter();this.draw(t,n-u.x,i-u.y,e,r,o,u.x,u.y)},translate:function(t,n){this.ctx.translate(t,n)},scale:function(t,n){this.ctx.scale(t,n)},rotate:function(t){this.ctx.rotate(t)},push:function(){this.ctx.save()},pop:function(){this.ctx.restore()},Canvas:function(t,n){return Luv.Graphics.Canvas(t||this.getWidth(),n||this.getHeight())},Image:function(t){return Luv.Graphics.Image(this.media,t)},Sprite:function(t,n,i,e,r){return Luv.Graphics.Sprite(t,n,i,e,r)},SpriteSheet:function(t,n,i,e,r,o){return Luv.Graphics.SpriteSheet(t,n,i,e,r,o)}});var t=2*Math.PI,n=function(t,n,i,e,r){var o=t[n];Array.isArray(i)?(o.r=i[0],o.g=i[1],o.b=i[2]):"object"==typeof i?(o.r=i.r,o.g=i.g,o.b=i.b):"string"==typeof i?(i=i.replace("#",""),o.r=parseInt(i.slice(0,2),16),o.g=parseInt(i.slice(2,4),16),o.b=parseInt(i.slice(4,6),16)):(o.r=i,o.g=e,o.b=r),t[n+"Style"]="rgb("+[o.r,o.g,o.b].join()+")"},i=function(t){return{r:t.r,g:t.g,b:t.b}},e=function(t,n,i,e){if(i>e.length)throw Error(n+" requires at least 4 parameters");if(1==e.length%2)throw Error(n+" requires an even number of parameters");t.ctx.moveTo(e[0],e[1]);for(var r=2;e.length>r;r+=2)t.ctx.lineTo(e[r],e[r+1]);t.ctx.stroke()},r=function(n){return n%=t,0>n?n+t:n},o=function(t,n){n.setTransform(1,0,0,1,0,0),u(n,t.getImageSmoothing()),n.lineWidth=t.getLineWidth(),n.lineCap=t.getLineCap(),n.globalAlpha=t.getAlpha()},u=function(t,n){t.webkitImageSmoothingEnabled=n,t.mozImageSmoothingEnabled=n,t.imageSmoothingEnabled=n},s=function(t,n){switch(n){case l.FILL:t.ctx.fillStyle=t.colorStyle,t.ctx.fill();break;case l.STROKE:t.ctx.strokeStyle=t.colorStyle,t.ctx.stroke();break;default:throw Error("Invalid mode: ["+n+']. Should be "fill" or "line"')}},a=function(t,n,i,e,r,o){t.ctx.beginPath(),t.ctx.rect(i,e,r,o),s(t,n),t.ctx.closePath()},h=function(t,n,i){var r=Array.isArray(i[0])?i[0]:Array.prototype.slice.call(i,0);t.ctx.beginPath(),e(t,"luv.graphics.polygon",6,r),s(t,n),t.ctx.closePath()},c=function(t,n,i,e,r,o,u){t.ctx.beginPath(),t.ctx.arc(i,e,r,o,u,!1),s(t,n)},f=function(n,i,e,r,o){c(n,i,e,r,o,0,t),n.ctx.closePath()},l={STROKE:1,FILL:2},d=function(t,n){return t===void 0?n:t},p=function(t,n,i){return Math.max(n,Math.min(i,Number(t)))}}(),function(){Luv.Graphics.Animation=Luv.Class("Luv.Graphics.Animation",{init:function(n,e){if(!Array.isArray(n))throw Error("Array of sprites needed. Got "+n);if(0===n.length)throw Error("No sprites where provided. Must provide at least one");this.sprites=n.slice(0),this.time=0,this.index=0,this.durations=i(n.length,e),this.intervals=t(this.durations),this.loopDuration=this.intervals[this.intervals.length-1]},update:function(t){var i;this.time+=t,i=Math.floor(this.time/this.loopDuration),this.time-=this.loopDuration*i,0!==i&&this.onLoopEnded(i),this.index=n(this.intervals,this.time)},gotoSprite:function(t){this.index=t,this.time=this.intervals[t]},getCurrentSprite:function(){return this.sprites[this.index]},onLoopEnded:function(){}}),"getWidth getHeight getDimensions getCenter draw".split(" ").forEach(function(t){Luv.Graphics.Animation.methods[t]=function(){var n=this.getCurrentSprite();return n[t].apply(n,arguments)}});var t=function(t){for(var n=[0],i=0,e=0;t.length>e;e++)i+=t[e],n.push(i);return n},n=function(t,n){for(var i=t.length-2,e=0,r=0;i>=e;)if(r=Math.floor((e+i)/2),n>=t[r+1])e=r+1;else{if(!(t[r]>n))break;i=r-1}return r},i=function(t,n){var i,r,o,u,s=[];if(Array.isArray(n))s=n.slice(0);else if("object"==typeof n){s.length=t;for(i in n)if(n.hasOwnProperty(i))for(o=e(i),u=Number(n[i]),r=0;o.length>r;r++)s[o[r]]=u}else for(n=Number(n),r=0;t>r;r++)s.push(n);if(s.length!=t)throw Error("The durations table length should be "+t+", but it is "+s.length);for(r=0;s.length>r;r++){if(s[r]===void 0)throw Error("Missing delay for sprite "+r);if(isNaN(s[r]))throw Error("Could not parse the delay for sprite "+r)}return s},e=function(t){var n,i,e,r,o;if("string"!=typeof t)throw Error("Unknown range type (must be integer or string in the form 'start-end'): "+t);if(n=t.match(/^(\d+)-(\d+)$/))if(i=[],e=Number(n[1]),r=Number(n[2]),r>e)for(o=e;r>=o;o++)i.push(o);else for(o=e;o>=r;o--)i.push(o);else i=[Number(t)];return i}}(),function(){Luv.Graphics.Canvas=Luv.Class("Luv.Graphics.Canvas",{init:function(t,n){var i=document.createElement("canvas");i.setAttribute("width",t),i.setAttribute("height",n),this.el=i},getContext:function(){return this.el.getContext("2d")},getWidth:function(){return Number(this.el.getAttribute("width"))},getHeight:function(){return Number(this.el.getAttribute("height"))},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getCenter:function(){return{x:this.getWidth()/2,y:this.getHeight()/2}},setDimensions:function(t,n){this.el.setAttribute("width",t),this.el.setAttribute("height",n)},draw:function(t,n,i){t.drawImage(this.el,n,i)}})}(),function(){Luv.Graphics.Image=Luv.Class("Luv.Graphics.Image",{init:function(t,n){var i=this;i.path=n,t.newAsset(i);var e=new Image;i.source=e,e.addEventListener("load",function(){t.registerLoad(i)}),e.addEventListener("error",function(){t.registerError(i)}),e.src=n},toString:function(){return'instance of Luv.Graphics.Image("'+this.path+'")'},getWidth:function(){return this.source.width},getHeight:function(){return this.source.height},getDimensions:function(){return{width:this.source.width,height:this.source.height}},getCenter:function(){return{x:this.source.width/2,y:this.source.height/2}},draw:function(t,n,i){if(!this.isLoaded())throw Error("Attepted to draw a non loaded image: "+this);t.drawImage(this.source,n,i)}}),Luv.Graphics.Image.include(Luv.Media.Asset)}(),function(){Luv.Graphics.Sprite=Luv.Class("Luv.Graphics.Sprite",{init:function(t,n,i,e,r){this.image=t,this.l=n,this.t=i,this.w=e,this.h=r},toString:function(){return"instance of Luv.Graphics.Sprite("+this.image+", "+this.l+", "+this.t+", "+this.w+", "+this.h+")"},getImage:function(){return this.image},getWidth:function(){return this.w},getHeight:function(){return this.h},getDimensions:function(){return{width:this.w,height:this.h}},getCenter:function(){return{x:this.w/2,y:this.h/2}},getBoundingBox:function(){return{left:this.l,top:this.t,width:this.w,height:this.h}},draw:function(t,n,i){if(!this.image.isLoaded())throw Error("Attepted to draw a prite of a non loaded image: "+this);t.drawImage(this.image.source,this.l,this.t,this.w,this.h,n,i,this.w,this.h)}})}(),function(){Luv.Graphics.SpriteSheet=Luv.Class("Luv.Graphics.SpriteSheet",{init:function(t,n,i,e,r,o){this.image=t,this.width=n,this.height=i,this.left=e||0,this.top=r||0,this.border=o||0},getSprites:function(){for(var n,i,e=[],r=0;arguments.length>r;r+=2){n=t(arguments[r]),i=t(arguments[r+1]);for(var o=0;i.length>o;o++)for(var u=0;n.length>u;u++)e.push(this.Sprite(n[u],i[o]))}return e},Sprite:function(t,n){return Luv.Graphics.Sprite(this.image,this.left+this.width*t+this.border*(t+1),this.top+this.height*n+this.border*(n+1),this.width,this.height)},Animation:function(t,n){var i=this.getSprites.apply(this,t);return Luv.Graphics.Animation(i,n)}});var t=function(t){if("number"==typeof t)return[t];if("string"==typeof t){var n=t.split("-");if(2!=n.length)throw Error("Could not parse from '"+t+"'. Must be of the form 'start-end'");var i,e=[],r=Number(n[0]),o=Number(n[1]);if(o>r)for(i=r;o>=i;i++)e.push(i);else for(i=r;i>=o;i--)e.push(i);return e}throw Error("Ranges must be integers or strings of the form 'start-end'. Got "+t)}}();