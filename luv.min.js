/*! luv 0.0.1 (2013-03-06) - https://github.com/kikito/luv.js */
/*! Minimal HTML5 game development lib */
/*! Enrique Garcia Cota */
(function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;e.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),i=Math.max(0,16-(n-t)),r=window.setTimeout(function(){e(n+i)},i);return t=n+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})})(),function(){Luv=function(e){e=t(e);var n=Object.create(Luv);if(n.el=e.el,e.load&&(n.load=e.load),e.update&&(n.update=e.update),e.draw&&(n.draw=e.draw),e.run&&(n.run=e.run),e.onResize&&(n.onResize=e.onResize),n.graphics=Luv.Graphics(n.el,e.width,e.height),n.timer=Luv.Timer(),n.keyboard=Luv.Keyboard(n.el),n.mouse=Luv.Mouse(n.el),n.media=Luv.Media(),e.fullWindow){var i=function(){n.graphics.setDimensions(window.innerWidth,window.innerHeight),n.onResize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",i,!1),window.addEventListener("orientationChange",i,!1)}return n};var t=function(t){t=t||{};var e=t.el,n=t.id,i=t.width,r=t.height,o=document.getElementsByTagName("body")[0],a=document.getElementsByTagName("html")[0],s="width: 100%; height: 100%; margin: 0; overflow: hidden;";return!e&&n&&(e=document.getElementById(n)),e?(!i&&e.getAttribute("width")&&(i=parseInt(e.getAttribute("width"),10)),!r&&e.getAttribute("height")&&(r=parseInt(e.getAttribute("height"),10))):(e=document.createElement("canvas"),o.appendChild(e)),t.fullWindow?(a.style.cssText=o.style.cssText=s,i=window.innerWidth,r=window.innerHeight):(i=i||800,r=r||600),e.setAttribute("width",i),e.setAttribute("height",r),t.el=e,t.width=i,t.height=r,t};Luv.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},Luv.extend(Luv,{load:function(){},draw:function(){},update:function(){},run:function(){var t=this;t.load();var e=function(n){t.timer.step(n);var i=t.timer.getDeltaTime();t.update(i),t.graphics.setCanvas(),t.graphics.clear(),t.draw(),t.timer.nextFrame(e)};t.timer.nextFrame(e)},onResize:function(){}})}(),function(){Luv.Timer=function(){return Luv.extend(Object.create(Luv.Timer),{microTime:0,deltaTime:0,deltaTimeLimit:.25})},Luv.extend(Luv.Timer,{getType:function(){return"Luv.Timer"},step:function(t){t>this.microTime&&(this.deltaTime=(t-this.microTime)/1e3,this.microTime=t)},setDeltaTimeLimit:function(t){this.deltaTimeLimit=t},getDeltaTimeLimit:function(){return this.deltaTimeLimit},getDeltaTime:function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},getMicroTime:function(){return this.microTime},getTime:function(){return this.getMicroTime()/1e3},getFPS:function(){return 0===this.deltaTime?0:1/this.deltaTime},nextFrame:function(t){window.requestAnimationFrame(t)}})}(),function(){Luv.Keyboard=function(t){var e=Luv.extend(Object.create(Luv.Keyboard),{keysDown:{},el:t});return t.tabIndex=1,t.focus(),t.addEventListener("keydown",function(t){var n=i(t);e.keysDown[n]=!0,e.onPressed(n,t.which)}),t.addEventListener("keyup",function(t){var n=i(t);e.keysDown[n]=!1,e.onReleased(n,t.which)}),e},Luv.extend(Luv.Keyboard,{getType:function(){return"Luv.Keyboard"},onPressed:function(){},onReleased:function(){},isDown:function(t){return!!this.keysDown[t]}});var t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},n={16:"rshift",17:"rctrl",18:"ralt"},i=function(i){var r,o=i.which;return r=i.keyLocation&&i.keyLocation>1?n[o]:i.shiftKey?e[o]||t[o]:t[o],r||String.fromCharCode(o)}}(),function(){Luv.Mouse=function(t){var i=Luv.extend(Object.create(Luv.Mouse),{x:0,y:0,pressedButtons:{},wheelTimeOuts:{}}),r=function(t){i.pressedButtons[t]=!0,i.onPressed(i.x,i.y,t)},o=function(t){i.pressedButtons[t]=!1,i.onReleased(i.x,i.y,t)},a=function(t){t.preventDefault();var e=n(t);clearTimeout(i.wheelTimeOuts[e]),i.wheelTimeOuts[e]=setTimeout(function(){o(e)},20),r(e)};return t.addEventListener("mousemove",function(e){var n=t.getBoundingClientRect();i.x=e.pageX-n.left,i.y=e.pageY-n.top}),t.addEventListener("mousedown",function(t){r(e(t))}),t.addEventListener("mouseup",function(t){o(e(t))}),t.addEventListener("DOMMouseScroll",a),t.addEventListener("mousewheel",a),i};var t={1:"l",2:"m",3:"r"},e=function(e){return t[e.which]},n=function(t){var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));return 1===e?"wu":"wd"};Luv.extend(Luv.Mouse,{getType:function(){return"Luv.Mouse"},getX:function(){return this.x},getY:function(){return this.y},getPosition:function(){return{x:this.x,y:this.y}},onPressed:function(){},onReleased:function(){},isPressed:function(t){return!!this.pressedButtons[t]}})}(),function(){Luv.Media=function(){return Luv.extend(Object.create(Luv.Media),{pending:0})},Luv.extend(Luv.Media,{getType:function(){return"Luv.Media"},isLoaded:function(){return 0===this.pending},getPending:function(){return this.pending},onAssetLoaded:function(){},onAssetError:function(t){throw Error("Could not load "+t)},onLoaded:function(){},newAsset:function(t,e,n){this.pending++,t.loadCallback=e,t.errorCallback=n,t.status="pending"},registerLoad:function(t){this.pending--,t.status="loaded",t.loadCallback&&t.loadCallback(t),this.onAssetLoaded(t),this.isLoaded()&&this.onLoaded()},registerError:function(t){this.pending--,t.status="error",t.errorCallback&&t.errorCallback(t),this.onAssetError(t)}})}(),function(){Luv.Media.Asset={getType:function(){return"Luv.Media.Asset"},isPending:function(){return"pending"==this.status},isLoaded:function(){return"loaded"==this.status},isError:function(){return"error"==this.status}}}(),function(){Luv.Media.Image=function(t,e,n){var i=this,r=Luv.extend(Object.create(Luv.Media.Image),{path:t});i.newAsset(r,e,n);var o=new Image;return r.source=o,o.addEventListener("load",function(){i.registerLoad(r)}),o.addEventListener("error",function(){i.registerError(r)}),o.src=t,r},Luv.extend(Luv.Media.Image,Luv.Media.Asset),Luv.extend(Luv.Media.Image,{getType:function(){return"Luv.Media.Image"},toString:function(){return'Luv.Media.Image("'+this.path+'")'},getWidth:function(){return this.source.width},getHeight:function(){return this.source.height},getDimensions:function(){return{width:this.source.width,height:this.source.height}}})}(),function(){Luv.Graphics=function(t,e,n){var i=Luv.extend(Object.create(Luv.Graphics),{width:e,height:n,lineWidth:1,lineCap:"butt",color:{},backgroundColor:{},defaultCanvas:Luv.Graphics.Canvas(t,e,n),Canvas:function(t,e){var n=document.createElement("canvas");return Luv.Graphics.Canvas(n,t||this.width,e||this.height)}});return i.setColor(255,255,255),i.setBackgroundColor(0,0,0),i.setCanvas(),i},Luv.extend(Luv.Graphics,{getType:function(){return"Luv.Graphics"},setCanvas:function(t){t=t||this.defaultCanvas,this.canvas=t,this.el=t.el,this.ctx=t.ctx,this.setLineWidth(this.lineWidth),this.setLineCap(this.lineCap),this.reset()},getCanvas:function(){return this.canvas},setColor:function(t,n,i,r){e(this,"color",t,n,i,r)},getColor:function(){return n(this.color)},setBackgroundColor:function(t,n,i,r){e(this,"backgroundColor",t,n,i,r)},getBackgroundColor:function(){return n(this.backgroundColor)},getWidth:function(){return this.width},getHeight:function(){return this.height},getDimensions:function(){return{width:this.width,height:this.height}},setDimensions:function(t,e){this.el.setAttribute("width",t),this.el.setAttribute("height",e),this.width=t,this.height=e},setLineWidth:function(t){this.lineWidth=t,this.ctx.lineWidth=t},getLineWidth:function(){return this.lineWidth},setLineCap:function(t){if("butt"!=t&&"round"!=t&&"square"!=t)throw Error("Line cap must be either 'butt', 'round' or 'square'");this.ctx.lineCap=t,this.lineCap=this.ctx.lineCap},getLineCap:function(){return this.lineCap},clear:function(){this.reset(),this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.width,this.height)},print:function(t,e,n){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(t,e,n)},line:function(){var t=Array.isArray(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),r(this,"luv.graphics.line",4,t),i(this,"line")},rectangle:function(t,e,n,r,o){this.ctx.beginPath(),this.ctx.rect(e,n,r,o),i(this,t),this.ctx.closePath()},polygon:function(){var t=arguments[0],e=arguments[1];if(!Array.isArray(e)){e=[];for(var n=1;arguments.length>n;n++)e[n-1]=arguments[n]}this.ctx.beginPath(),r(this,"luv.graphics.polygon",6,e),i(this,t),this.ctx.closePath()},circle:function(e,n,i,r){this.arc(e,n,i,r,0,t),this.ctx.closePath()},arc:function(t,e,n,r,o,a){this.ctx.beginPath(),this.ctx.arc(e,n,r,o,a,!1),i(this,t)},drawImage:function(t,e,n,i,r,a,s,u){var c=this.ctx;if(!t.isLoaded())throw Error("Attepted to draw a non loaded image: "+t);i=i===void 0?1:i,r=r===void 0?1:r,a=a===void 0?0:o(a),s=s===void 0?0:s,u=u===void 0?0:u,1!==i||1!==r||0!==a||0!==s||0!==u?(c.save(),c.translate(e,n),c.translate(s,u),c.rotate(a),c.scale(i,r),c.drawImage(t.source,-s,-u),c.restore()):c.drawImage(t.source,e,n)},drawCenteredImage:function(t,e,n,i,r,o){var a=t.getDimensions(),s=a.width/2,u=a.height/2;this.drawImage(t,e-s,n-u,i,r,o,s,u)},drawCanvas:function(t,e,n){this.ctx.drawImage(t.el,e,n)},translate:function(t,e){this.ctx.translate(t,e)},scale:function(t,e){this.ctx.scale(t,e)},rotate:function(t){this.ctx.rotate(t)},reset:function(){this.ctx.setTransform(1,0,0,1,0,0)},push:function(){this.ctx.save()},pop:function(){this.ctx.restore()}}),Luv.Graphics.Canvas=function(t,e,n){return t.setAttribute("width",e),t.setAttribute("height",n),Luv.extend(Object.create(Luv.Graphics.Canvas),{width:e,height:n,el:t,ctx:t.getContext("2d")})},Luv.extend(Luv.Graphics.Canvas,{getType:function(){return"Luv.Graphics.Canvas"},getWidth:function(){return this.width},getHeight:function(){return this.height},getDimensions:function(){return{width:this.width,height:this.height}},setDimensions:function(t,e){this.el.setAttribute("width",t),this.el.setAttribute("height",e),this.width=t,this.height=e}});var t=2*Math.PI,e=function(t,e,n,i,r,o){var a=t[e];Array.isArray(n)?(a.r=n[0],a.g=n[1],a.b=n[2],a.a=n[3]||255):(a.r=n,a.g=i,a.b=r,a.a=o||255),t[e+"Style"]="rgba("+[a.r,a.g,a.b,a.a/255].join()+")"},n=function(t){return[t.r,t.g,t.b,t.a]},i=function(t,e){switch(e){case"fill":t.ctx.fillStyle=t.colorStyle,t.ctx.fill();break;case"line":t.ctx.strokeStyle=t.colorStyle,t.ctx.stroke();break;default:throw Error("Invalid mode: ["+e+']. Should be "fill" or "line"')}},r=function(t,e,n,i){if(n>i.length)throw Error(e+" requires at least 4 parameters");if(1==i.length%2)throw Error(e+" requires an even number of parameters");t.ctx.moveTo(i[0],i[1]);for(var r=2;i.length>r;r+=2)t.ctx.lineTo(i[r],i[r+1]);t.ctx.stroke()},o=function(t){return t%=2*Math.PI,t>=0?t:t+2*Math.PI}}();