/*! luv 0.0.1 (2013-02-10) - https://github.com/kikito/luv.js */
/*! Minimal HTML5 game development lib */
/*! Enrique Garcia Cota */
(function(){(function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;e.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),o=window.setTimeout(function(){e(i+n)},n);return t=i+n,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})})(),Luv=function(t){t=t||{};var e=t.el,i=t.el_id,n=t.width,o=t.height;!e&&i&&(e=document.getElementById(i)),this.graphics=new Luv.Graphics(e,n,o),e=this.graphics.el,this.timer=new Luv.Timer,this.keyboard=new Luv.Keyboard(e),this.mouse=new Luv.Mouse(e),this.media=new Luv.Media};var t=Luv.prototype;t.update=function(){},t.draw=function(){},t.load=function(){},t.run=function(){var t=this;t.load();var e=function(i){t.timer.step(i);var n=t.timer.getDeltaTime();t.update(n),t.graphics.clear(),t.draw(),t.timer.nextFrame(e)};t.timer.nextFrame(e)},Luv.Graphics=function(t,e,i){t?(!e&&t.getAttribute("width")&&(e=parseInt(t.getAttribute("width"),10)),!i&&t.getAttribute("height")&&(i=parseInt(t.getAttribute("height"),10))):(t=document.createElement("canvas"),document.getElementsByTagName("body")[0].appendChild(t)),e=e||800,i=i||600,t.setAttribute("width",e),t.setAttribute("height",i),this.el=t,this.width=e,this.height=i,this.color={},this.backgroundColor={},this.setColor(255,255,255),this.setBackgroundColor(0,0,0),this.ctx=t.getContext("2d")};var e=2*Math.PI,i=function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=function(t,e,n,o,r,a){var s=t[e];i(n)?(s.r=n[0],s.g=n[1],s.b=n[2],s.a=n[3]||255):(s.r=n,s.g=o,s.b=r,s.a=a||255),t[e+"Style"]="rgba("+[s.r,s.g,s.b,s.a/255].join()+")"},o=function(t){return[t.r,t.g,t.b,t.a]},r=function(t){switch(t){case"fill":this.ctx.fillStyle=this.colorStyle,this.ctx.fill();break;case"line":this.ctx.strokeStyle=this.colorStyle,this.ctx.stroke();break;default:throw Error("Invalid mode: ["+t+']. Should be "fill" or "line"')}},a=function(t,e,i){if(e>i.length)throw Error(t+" requires at least 4 parameters");if(1==i.length%2)throw Error(t+" requires an even number of parameters");this.ctx.moveTo(i[0],i[1]);for(var n=2;i.length>n;n+=2)this.ctx.lineTo(i[n],i[n+1]);this.ctx.stroke()},s=Luv.Graphics.prototype;s.setColor=function(t,e,i,o){n(this,"color",t,e,i,o)},s.getColor=function(){return o(this.color)},s.setBackgroundColor=function(t,e,i,o){n(this,"backgroundColor",t,e,i,o)},s.getBackgroundColor=function(){return o(this.backgroundColor)},s.setLineWidth=function(t){this.ctx.lineWidth=t},s.getLineWidth=function(){return this.ctx.lineWidth},s.setLineCap=function(t){if("butt"!=t&&"round"!=t&&"square"!=t)throw Error("Line cap must be either 'butt', 'round' or 'square'");this.ctx.lineCap=t},s.getLineCap=function(){return this.ctx.lineCap},s.clear=function(){this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.width,this.height)},s.print=function(t,e,i){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(t,e,i)},s.line=function(){var t=i(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),a.call(this,"luv.graphics.line",4,t),r.call(this,"line")},s.rectangle=function(t,e,i,n,o){this.ctx.beginPath(),this.ctx.rect(e,i,n,o),r.call(this,t),this.ctx.closePath()},s.polygon=function(){var t=arguments[0],e=arguments[1];if(!i(e)){e=[];for(var n=1;arguments.length>n;n++)e[n-1]=arguments[n]}this.ctx.beginPath(),a.call(this,"luv.graphics.polygon",6,e),r.call(this,t),this.ctx.closePath()},s.circle=function(t,i,n,o){this.arc(t,i,n,o,0,e),this.ctx.closePath()},s.arc=function(t,e,i,n,o,a){this.ctx.beginPath(),this.ctx.arc(e,i,n,o,a,!1),r.call(this,t)},Luv.Timer=function(){this.microTime=0,this.deltaTime=0,this.deltaTimeLimit=.25};var c=Luv.Timer.prototype;c.step=function(t){t>this.microTime&&(this.deltaTime=(t-this.microTime)/1e3,this.microTime=t)},c.getMicroTime=function(){return this.microTime},c.getTime=function(){return this.getMicroTime()/1e3},c.getDeltaTime=function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},c.getDeltaTimeLimit=function(){return this.deltaTimeLimit},c.setDeltaTimeLimit=function(t){this.deltaTimeLimit=t},c.getFPS=function(){return 0===this.deltaTime?0:1/this.deltaTime},c.nextFrame=function(t){window.requestAnimationFrame(t)};var u={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},h={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},l={16:"rshift",17:"rctrl",18:"ralt"},d=function(t){var e,i=t.which;return e=t.keyLocation&&t.keyLocation>1?l[i]:t.shiftKey?h[i]:u[i],e||String.fromCharCode(i)};Luv.Keyboard=function(t){t.tabIndex=1,t.focus(),this.keysDown={};var e=this;t.addEventListener("keydown",function(t){var i=d(t);e.keysDown[i]=!0,e.onPressed(i,t.which)}),t.addEventListener("keyup",function(t){var i=d(t);e.keysDown[i]=!1,e.onReleased(i,t.which)})};var f=Luv.Keyboard.prototype;f.onPressed=function(){},f.onReleased=function(){},f.isDown=function(t){return!!this.keysDown[t]};var m=function(t){for(var e=0,i=0;t;)e+=t.offsetLeft||0,i+=t.offsetTop||0,t=t.offsetParent;return{left:e,top:i}},g=function(t){var e=0,i=0;return t.pageX||t.pageY?(e=t.pageX,i=t.pageY):(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:i}},p={1:"l",2:"m",3:"r"},v=function(t){return p[t.which]};Luv.Mouse=function(t){this.x=0,this.y=0;var e=this;t.addEventListener("mousemove",function(i){var n=g(i),o=m(t);e.x=n.x-o.left,e.y=n.y-o.top}),t.addEventListener("mousedown",function(t){e.onPressed(e.x,e.y,v(t))}),t.addEventListener("mouseup",function(t){e.onReleased(e.x,e.y,v(t))})};var w=Luv.Mouse.prototype;w.getPosition=function(){return{x:this.x,y:this.y}},w.getX=function(){return this.x},w.getY=function(){return this.y},w.onPressed=function(){},w.onReleased=function(){},Luv.Media=function(){this.pending=0;var t=this;this.Resource=function(e,i){var n=this;t.pending++,e.addEventListener("load",function(){t.pending--,i&&i(n),t.onResourceLoaded(n),t.isLoaded()&&t.onLoaded()}),e.addEventListener("error",function(e){t.pending--,t.onLoadError(n,e)})}};var L=Luv.Media.prototype;L.isLoaded=function(){return 0===this.pending},L.getPending=function(){return this.pending},L.onResourceLoaded=function(){},L.onLoadError=function(t){throw Error("Could not load "+t)},L.onLoaded=function(){}})();