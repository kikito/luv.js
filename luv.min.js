/*! luv 0.0.1 (2013-02-17) - https://github.com/kikito/luv.js */
/*! Minimal HTML5 game development lib */
/*! Enrique Garcia Cota */
(function(){(function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;e.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),r=window.setTimeout(function(){e(i+n)},n);return t=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})})();var t=function(t){t=t||{};var e=t.el,i=t.id,n=t.width,r=t.height;return!e&&i&&(e=document.getElementById(i)),e?(!n&&e.getAttribute("width")&&(n=parseInt(e.getAttribute("width"),10)),!r&&e.getAttribute("height")&&(r=parseInt(e.getAttribute("height"),10))):(e=document.createElement("canvas"),document.getElementsByTagName("body")[0].appendChild(e)),n=n||800,r=r||600,e.setAttribute("width",n),e.setAttribute("height",r),t.el=e,t.width=n,t.height=r,t},e={update:function(){},draw:function(){},load:function(){},run:function(){var t=this;t.load();var e=function(i){t.timer.step(i);var n=t.timer.getDeltaTime();t.update(n),t.graphics.clear(),t.draw(),t.timer.nextFrame(e)};t.timer.nextFrame(e)}};Luv=function(i){i=t(i);var n=Object.create(e);return n.el=i.el,i.load&&(n.load=i.load),i.update&&(n.update=i.update),i.draw&&(n.draw=i.draw),i.run&&(n.run=i.run),n.graphics=Luv.Graphics(n.el,i.width,i.height),n.timer=Luv.Timer(),n.keyboard=Luv.Keyboard(n.el),n.mouse=Luv.Mouse(n.el),n.media=Luv.Media(),n};var i={step:function(t){t>this.microTime&&(this.deltaTime=(t-this.microTime)/1e3,this.microTime=t)},getMicroTime:function(){return this.microTime},getTime:function(){return this.getMicroTime()/1e3},getDeltaTime:function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},getDeltaTimeLimit:function(){return this.deltaTimeLimit},setDeltaTimeLimit:function(t){this.deltaTimeLimit=t},getFPS:function(){return 0===this.deltaTime?0:1/this.deltaTime},nextFrame:function(t){window.requestAnimationFrame(t)}};Luv.Timer=function(){var t=Object.create(i);return t.microTime=0,t.deltaTime=0,t.deltaTimeLimit=.25,t};var n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},r={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},o={16:"rshift",17:"rctrl",18:"ralt"},a=function(t){var e,i=t.which;return e=t.keyLocation&&t.keyLocation>1?o[i]:t.shiftKey?r[i]:n[i],e||String.fromCharCode(i)},s={onPressed:function(){},onReleased:function(){},isDown:function(t){return!!this.keysDown[t]}};Luv.Keyboard=function(t){var e=Object.create(s);return e.keysDown={},t.tabIndex=1,t.focus(),t.addEventListener("keydown",function(t){var i=a(t);e.keysDown[i]=!0,e.onPressed(i,t.which)}),t.addEventListener("keyup",function(t){var i=a(t);e.keysDown[i]=!1,e.onReleased(i,t.which)}),e};var c={1:"l",2:"m",3:"r"},u=function(t){return c[t.which]},h={getX:function(){return this.x},getY:function(){return this.y},getPosition:function(){return{x:this.x,y:this.y}},onPressed:function(){},onReleased:function(){}};Luv.Mouse=function(t){var e=Object.create(h);return e.x=0,e.y=0,t.addEventListener("mousemove",function(i){var n=t.getBoundingClientRect();e.x=i.pageX-n.left,e.y=i.pageY-n.top}),t.addEventListener("mousedown",function(t){e.onPressed(e.x,e.y,u(t))}),t.addEventListener("mouseup",function(t){e.onReleased(e.x,e.y,u(t))}),e};var d={isPending:function(){return"pending"==this.status},isLoaded:function(){return"loaded"==this.status},isError:function(){return"error"==this.status}},l=Object.create(d);l.getWidth=function(){return this.source.width},l.getHeight=function(){return this.source.height},l.getDimensions=function(){return{width:this.source.width,height:this.source.height}};var f={isLoaded:function(){return 0===this.pending},getPending:function(){return this.pending},onAssetLoaded:function(){},onLoadError:function(t){throw Error("Could not load "+t)},onLoaded:function(){},newAsset:function(t,e,i){this.pending++,t.loadCallback=e,t.errorCallback=i,t.status="pending"},registerLoad:function(t){this.pending--,t.status="loaded",t.loadCallback&&t.loadCallback(t),this.onAssetLoaded(t),this.isLoaded()&&this.onLoaded()},registerError:function(t){this.pending--,t.status="error",t.errorCallback&&t.errorCallback(t),this.onLoadError(t)}};Luv.Media=function(){var t=Object.create(f);return t.pending=0,t.Image=function(e,i,n){var r=Object.create(l);t.newAsset(r,i,n);var o=new Image;return r.source=o,o.addEventListener("load",function(){t.registerLoad(r)}),o.addEventListener("error",function(){t.registerError(r)}),o.src=e,r},t};var m=2*Math.PI,g=function(t,e,i,n,r,o){var a=t[e];Array.isArray(i)?(a.r=i[0],a.g=i[1],a.b=i[2],a.a=i[3]||255):(a.r=i,a.g=n,a.b=r,a.a=o||255),t[e+"Style"]="rgba("+[a.r,a.g,a.b,a.a/255].join()+")"},w=function(t){return[t.r,t.g,t.b,t.a]},p=function(t){switch(t){case"fill":this.ctx.fillStyle=this.colorStyle,this.ctx.fill();break;case"line":this.ctx.strokeStyle=this.colorStyle,this.ctx.stroke();break;default:throw Error("Invalid mode: ["+t+']. Should be "fill" or "line"')}},v=function(t,e,i){if(e>i.length)throw Error(t+" requires at least 4 parameters");if(1==i.length%2)throw Error(t+" requires an even number of parameters");this.ctx.moveTo(i[0],i[1]);for(var n=2;i.length>n;n+=2)this.ctx.lineTo(i[n],i[n+1]);this.ctx.stroke()},b={setColor:function(t,e,i,n){g(this,"color",t,e,i,n)},getColor:function(){return w(this.color)},setBackgroundColor:function(t,e,i,n){g(this,"backgroundColor",t,e,i,n)},getBackgroundColor:function(){return w(this.backgroundColor)},setLineWidth:function(t){this.ctx.lineWidth=t},getLineWidth:function(){return this.ctx.lineWidth},setLineCap:function(t){if("butt"!=t&&"round"!=t&&"square"!=t)throw Error("Line cap must be either 'butt', 'round' or 'square'");this.ctx.lineCap=t},getLineCap:function(){return this.ctx.lineCap},clear:function(){this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.width,this.height)},print:function(t,e,i){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(t,e,i)},line:function(){var t=Array.isArray(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),v.call(this,"luv.graphics.line",4,t),p.call(this,"line")},rectangle:function(t,e,i,n,r){this.ctx.beginPath(),this.ctx.rect(e,i,n,r),p.call(this,t),this.ctx.closePath()},polygon:function(){var t=arguments[0],e=arguments[1];if(!Array.isArray(e)){e=[];for(var i=1;arguments.length>i;i++)e[i-1]=arguments[i]}this.ctx.beginPath(),v.call(this,"luv.graphics.polygon",6,e),p.call(this,t),this.ctx.closePath()},circle:function(t,e,i,n){this.arc(t,e,i,n,0,m),this.ctx.closePath()},arc:function(t,e,i,n,r,o){this.ctx.beginPath(),this.ctx.arc(e,i,n,r,o,!1),p.call(this,t)},drawImage:function(t,e,i){if(!t.isLoaded())throw Error("Attepted to draw a non loaded image: "+t);this.ctx.drawImage(t.source,e,i)}};Luv.Graphics=function(t,e,i){var n=Object.create(b);return n.el=t,n.width=e,n.height=i,n.ctx=t.getContext("2d"),n.color={},n.backgroundColor={},n.setColor(255,255,255),n.setBackgroundColor(0,0,0),n}})();