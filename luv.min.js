/*! luv 0.0.1 (2013-03-15) - https://github.com/kikito/luv.js */
/*! Minimal HTML5 game development lib */
/*! Enrique Garcia Cota */
(function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;e.length>i&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),r=window.setTimeout(function(){e(i+n)},n);return t=i+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})})(),function(){var t=function(t){for(var e,i=1;arguments.length>i;i++){e=arguments[i];for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}return t},e={toString:function(){return"instance of "+this.getClass().getName()}},i=t(function(){return Object.create(e)},{init:function(){},instanceProto:e,toString:function(){return"Base"},getName:function(){return"Base"},getSuper:function(){return null},include:function(){for(var e=[this.instanceProto],i=0;arguments.length>i;i++)e.push(arguments[i]);return t.apply(this,e),this},subclass:function(e,i){i=i||{};var n=this,r=function(){return e},s=t(Object.create(n.instanceProto),i);delete s.init;var o=t(function(){var t=Object.create(s);return o.init.apply(t,arguments),t},{init:i.init||n.init,getName:r,toString:r,getSuper:function(){return n},include:n.include,subclass:n.subclass,instanceProto:s});return s.getClass=function(){return o},o}});e.getClass=function(){return i},Luv=i.subclass("Luv",{init:function(t){if(t=n(t),this.el=t.el,t.load&&(this.load=t.load),t.update&&(this.update=t.update),t.draw&&(this.draw=t.draw),t.run&&(this.run=t.run),t.onResize&&(this.onResize=t.onResize),this.media=Luv.Media(),this.timer=Luv.Timer(),this.keyboard=Luv.Keyboard(this.el),this.mouse=Luv.Mouse(this.el),this.graphics=Luv.Graphics(this.el,this.media),t.fullWindow){var e=function(){this.graphics.setDimensions(window.innerWidth,window.innerHeight),this.onResize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",e,!1),window.addEventListener("orientationChange",e,!1)}},load:function(){},draw:function(){},update:function(){},run:function(){var t=this;t.load();var e=function(i){t.timer.step(i);var n=t.timer.getDeltaTime();t.update(n),t.graphics.setCanvas(),t.graphics.clear(),t.draw(),t.timer.nextFrame(e)};t.timer.nextFrame(e)},onResize:function(){}}),Luv.Class=function(t,e){return i.subclass(t,e)};var n=function(t){t=t||{};var e=t.el,i=t.id,n=t.width,r=t.height,s=document.getElementsByTagName("body")[0],o=document.getElementsByTagName("html")[0],a="width: 100%; height: 100%; margin: 0; overflow: hidden;";return!e&&i&&(e=document.getElementById(i)),e?(!n&&e.getAttribute("width")&&(n=parseInt(e.getAttribute("width"),10)),!r&&e.getAttribute("height")&&(r=parseInt(e.getAttribute("height"),10))):(e=document.createElement("canvas"),s.appendChild(e)),t.fullWindow?(o.style.cssText=s.style.cssText=a,n=window.innerWidth,r=window.innerHeight):(n=n||800,r=r||600),e.setAttribute("width",n),e.setAttribute("height",r),t.el=e,t.width=n,t.height=r,t}}(),function(){Luv.Timer=Luv.Class("Luv.Timer",{init:function(){this.microTime=0,this.deltaTime=0,this.deltaTimeLimit=.25},step:function(t){t>this.microTime&&(this.deltaTime=(t-this.microTime)/1e3,this.microTime=t)},setDeltaTimeLimit:function(t){this.deltaTimeLimit=t},getDeltaTimeLimit:function(){return this.deltaTimeLimit},getDeltaTime:function(){return Math.min(this.deltaTime,this.deltaTimeLimit)},getMicroTime:function(){return this.microTime},getTime:function(){return this.getMicroTime()/1e3},getFPS:function(){return 0===this.deltaTime?0:1/this.deltaTime},nextFrame:function(t){window.requestAnimationFrame(t)}})}(),function(){Luv.Keyboard=Luv.Class("Luv.Keyboard",{init:function(t){var e=this;return e.keysDown={},e.el=t,t.tabIndex=1,t.focus(),t.addEventListener("keydown",function(t){var i=n(t);e.keysDown[i]=!0,e.onPressed(i,t.which)}),t.addEventListener("keyup",function(t){var i=n(t);e.keysDown[i]=!1,e.onReleased(i,t.which)}),e},onPressed:function(){},onReleased:function(){},isDown:function(t){return!!this.keysDown[t]}});var t={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"lmeta",92:"rmeta",93:"mode",96:"kp0",97:"kp1",98:"kp2",99:"kp3",100:"kp4",101:"kp5",102:"kp6",103:"kp7",104:"kp8",105:"kp9",106:"kp*",107:"kp+",109:"kp-",110:"kp.",111:"kp/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:",",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e={192:"~",48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",109:"_",61:"+",219:"{",221:"}",220:"|",59:":",222:'"',188:"<",189:">",191:"?",96:"insert",97:"end",98:"down",99:"pagedown",100:"left",102:"right",103:"home",104:"up",105:"pageup"},i={16:"rshift",17:"rctrl",18:"ralt"},n=function(n){var r,s=n.which;return r=n.keyLocation&&n.keyLocation>1?i[s]:n.shiftKey?e[s]||t[s]:t[s],r||String.fromCharCode(s)}}(),function(){Luv.Mouse=Luv.Class("Luv.Mouse",{init:function(t){var n=this;n.x=0,n.y=0,n.pressedButtons={},n.wheelTimeOuts={};var r=function(t){n.pressedButtons[t]=!0,n.onPressed(n.x,n.y,t)},s=function(t){n.pressedButtons[t]=!1,n.onReleased(n.x,n.y,t)},o=function(t){t.preventDefault();var e=i(t);clearTimeout(n.wheelTimeOuts[e]),n.wheelTimeOuts[e]=setTimeout(function(){s(e)},20),r(e)};t.addEventListener("mousemove",function(e){var i=t.getBoundingClientRect();n.x=e.pageX-i.left,n.y=e.pageY-i.top}),t.addEventListener("mousedown",function(t){r(e(t))}),t.addEventListener("mouseup",function(t){s(e(t))}),t.addEventListener("DOMMouseScroll",o),t.addEventListener("mousewheel",o)},getX:function(){return this.x},getY:function(){return this.y},getPosition:function(){return{x:this.x,y:this.y}},onPressed:function(){},onReleased:function(){},isPressed:function(t){return!!this.pressedButtons[t]}});var t={1:"l",2:"m",3:"r"},e=function(e){return t[e.which]},i=function(t){var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail));return 1===e?"wu":"wd"}}(),function(){Luv.Media=Luv.Class("Luv.Media",{init:function(){this.pending=0},isLoaded:function(){return 0===this.pending},getPending:function(){return this.pending},onAssetLoaded:function(){},onAssetError:function(t){throw Error("Could not load "+t)},onLoaded:function(){},newAsset:function(t){this.pending++,t.status="pending"},registerLoad:function(t){this.pending--,t.status="loaded",this.onAssetLoaded(t),this.isLoaded()&&this.onLoaded()},registerError:function(t){this.pending--,t.status="error",this.onAssetError(t)}}),Luv.Media.Asset={isPending:function(){return"pending"==this.status},isLoaded:function(){return"loaded"==this.status},isError:function(){return"error"==this.status}}}(),function(){Luv.Graphics=Luv.Class("Luv.Graphics",{init:function(t,e){this.el=t,this.media=e,this.lineWidth=1,this.lineCap="butt",this.color={},this.backgroundColor={};var i=this.getDimensions();this.defaultCanvas=this.Canvas(i.width,i.height),this.defaultCanvas.el=t,this.setColor(255,255,255),this.setBackgroundColor(0,0,0),this.setCanvas()},setCanvas:function(t){t=t||this.defaultCanvas,this.canvas=t,this.el=t.el,this.ctx=t.getContext(),this.setLineWidth(this.lineWidth),this.setLineCap(this.lineCap),this.reset()},getCanvas:function(){return this.canvas},setColor:function(t,i,n,r){e(this,"color",t,i,n,r)},getColor:function(){return i(this.color)},setBackgroundColor:function(t,i,n,r){e(this,"backgroundColor",t,i,n,r)},getBackgroundColor:function(){return i(this.backgroundColor)},getWidth:function(){return parseInt(this.el.getAttribute("width"),10)},getHeight:function(){return parseInt(this.el.getAttribute("height"),10)},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimensions:function(t,e){this.el.setAttribute("width",t),this.el.setAttribute("height",e)},setLineWidth:function(t){this.lineWidth=t,this.ctx.lineWidth=t},getLineWidth:function(){return this.lineWidth},setLineCap:function(t){if("butt"!=t&&"round"!=t&&"square"!=t)throw Error("Line cap must be either 'butt', 'round' or 'square'");this.ctx.lineCap=t,this.lineCap=this.ctx.lineCap},getLineCap:function(){return this.lineCap},clear:function(){this.reset(),this.ctx.fillStyle=this.backgroundColorStyle,this.ctx.fillRect(0,0,this.getWidth(),this.getHeight())},print:function(t,e,i){this.ctx.fillStyle=this.colorStyle,this.ctx.fillText(t,e,i)},line:function(){var t=Array.isArray(arguments[0])?arguments[0]:arguments;this.ctx.beginPath(),r(this,"luv.graphics.line",4,t),n(this,"line")},rectangle:function(t,e,i,r,s){this.ctx.beginPath(),this.ctx.rect(e,i,r,s),n(this,t),this.ctx.closePath()},polygon:function(){var t=arguments[0],e=arguments[1];if(!Array.isArray(e)){e=[];for(var i=1;arguments.length>i;i++)e[i-1]=arguments[i]}this.ctx.beginPath(),r(this,"luv.graphics.polygon",6,e),n(this,t),this.ctx.closePath()},circle:function(e,i,n,r){this.arc(e,i,n,r,0,t),this.ctx.closePath()},arc:function(t,e,i,r,s,o){this.ctx.beginPath(),this.ctx.arc(e,i,r,s,o,!1),n(this,t)},drawImage:function(t,e,i,n,r,o,a,u){var h=this.ctx;if(!t.isLoaded())throw Error("Attepted to draw a non loaded image: "+t);n=n===void 0?1:n,r=r===void 0?1:r,o=o===void 0?0:s(o),a=a===void 0?0:a,u=u===void 0?0:u,1!==n||1!==r||0!==o||0!==a||0!==u?(h.save(),h.translate(e,i),h.translate(a,u),h.rotate(o),h.scale(n,r),h.drawImage(t.source,-a,-u),h.restore()):h.drawImage(t.source,e,i)},drawCenteredImage:function(t,e,i,n,r,s){var o=t.getDimensions(),a=o.width/2,u=o.height/2;this.drawImage(t,e-a,i-u,n,r,s,a,u)},drawCanvas:function(t,e,i){this.ctx.drawImage(t.el,e,i)},translate:function(t,e){this.ctx.translate(t,e)},scale:function(t,e){this.ctx.scale(t,e)},rotate:function(t){this.ctx.rotate(t)},reset:function(){this.ctx.setTransform(1,0,0,1,0,0)},push:function(){this.ctx.save()},pop:function(){this.ctx.restore()},Canvas:function(t,e){return Luv.Graphics.Canvas(t||this.getWidth(),e||this.getHeight())},Image:function(t){return Luv.Graphics.Image(this.media,t)}});var t=2*Math.PI,e=function(t,e,i,n,r,s){var o=t[e];Array.isArray(i)?(o.r=i[0],o.g=i[1],o.b=i[2],o.a=i[3]||255):(o.r=i,o.g=n,o.b=r,o.a=s||255),t[e+"Style"]="rgba("+[o.r,o.g,o.b,o.a/255].join()+")"},i=function(t){return[t.r,t.g,t.b,t.a]},n=function(t,e){switch(e){case"fill":t.ctx.fillStyle=t.colorStyle,t.ctx.fill();break;case"line":t.ctx.strokeStyle=t.colorStyle,t.ctx.stroke();break;default:throw Error("Invalid mode: ["+e+']. Should be "fill" or "line"')}},r=function(t,e,i,n){if(i>n.length)throw Error(e+" requires at least 4 parameters");if(1==n.length%2)throw Error(e+" requires an even number of parameters");t.ctx.moveTo(n[0],n[1]);for(var r=2;n.length>r;r+=2)t.ctx.lineTo(n[r],n[r+1]);t.ctx.stroke()},s=function(e){return e%=t,e>=0?e:e+t}}(),function(){Luv.Graphics.Canvas=Luv.Class("Luv.Graphics.Canvas",{init:function(t,e){var i=document.createElement("canvas");i.setAttribute("width",t),i.setAttribute("height",e),this.el=i},getContext:function(){return this.el.getContext("2d")},getWidth:function(){return parseInt(this.el.getAttribute("width"),10)},getHeight:function(){return parseInt(this.el.getAttribute("height"),10)},getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimensions:function(t,e){this.el.setAttribute("width",t),this.el.setAttribute("height",e)}})}(),function(){Luv.Graphics.Image=Luv.Class("Luv.Graphics.Image",{init:function(t,e){var i=this;i.path=e,t.newAsset(i);var n=new Image;i.source=n,n.addEventListener("load",function(){t.registerLoad(i)}),n.addEventListener("error",function(){t.registerError(i)}),n.src=e},toString:function(){return'Luv.Graphics.Image("'+this.path+'")'},getWidth:function(){return this.source.width},getHeight:function(){return this.source.height},getDimensions:function(){return{width:this.source.width,height:this.source.height}}}),Luv.Graphics.Image.include(Luv.Media.Asset)}();