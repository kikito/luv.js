<!DOCTYPE html>  <html> <head>   <title>keyboard.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="Luv.html">                 Luv.js               </a>                                           <a class="source" href="graphics.html">                 graphics.js               </a>                                           <a class="source" href="keyboard.html">                 keyboard.js               </a>                                           <a class="source" href="media.html">                 media.js               </a>                                           <a class="source" href="mouse.html">                 mouse.js               </a>                                           <a class="source" href="shims.html">                 shims.js               </a>                                           <a class="source" href="timer.html">                 timer.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               keyboard.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>keycodes/ algorithms inspired by http://www.selfcontained.us/2009/09/16/getting-keycode-values-in-javascript/</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">8</span><span class="o">:</span> <span class="s2">&quot;backspace&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="o">:</span> <span class="s2">&quot;tab&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="o">:</span> <span class="s2">&quot;enter&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="o">:</span> <span class="s2">&quot;shift&quot;</span><span class="p">,</span> <span class="mi">17</span><span class="o">:</span> <span class="s2">&quot;ctrl&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="o">:</span> <span class="s2">&quot;alt&quot;</span><span class="p">,</span>
  <span class="mi">19</span><span class="o">:</span> <span class="s2">&quot;pause&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="o">:</span> <span class="s2">&quot;capslock&quot;</span><span class="p">,</span> <span class="mi">27</span><span class="o">:</span> <span class="s2">&quot;escape&quot;</span><span class="p">,</span> <span class="mi">33</span><span class="o">:</span> <span class="s2">&quot;pageup&quot;</span><span class="p">,</span> <span class="mi">34</span><span class="o">:</span> <span class="s2">&quot;pagedown&quot;</span><span class="p">,</span>
  <span class="mi">35</span><span class="o">:</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="o">:</span> <span class="s2">&quot;home&quot;</span><span class="p">,</span> <span class="mi">37</span><span class="o">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="o">:</span> <span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="mi">39</span><span class="o">:</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="o">:</span> <span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="mi">45</span><span class="o">:</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
  <span class="mi">46</span><span class="o">:</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="mi">91</span><span class="o">:</span> <span class="s2">&quot;lmeta&quot;</span><span class="p">,</span> <span class="mi">92</span><span class="o">:</span> <span class="s2">&quot;rmeta&quot;</span><span class="p">,</span> <span class="mi">93</span><span class="o">:</span> <span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="mi">96</span><span class="o">:</span> <span class="s2">&quot;kp0&quot;</span><span class="p">,</span> <span class="mi">97</span><span class="o">:</span> <span class="s2">&quot;kp1&quot;</span><span class="p">,</span>
  <span class="mi">98</span><span class="o">:</span> <span class="s2">&quot;kp2&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="o">:</span> <span class="s2">&quot;kp3&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="o">:</span> <span class="s2">&quot;kp4&quot;</span><span class="p">,</span> <span class="mi">101</span><span class="o">:</span> <span class="s2">&quot;kp5&quot;</span><span class="p">,</span> <span class="mi">102</span><span class="o">:</span> <span class="s2">&quot;kp6&quot;</span><span class="p">,</span> <span class="mi">103</span><span class="o">:</span> <span class="s2">&quot;kp7&quot;</span><span class="p">,</span> <span class="mi">104</span><span class="o">:</span> <span class="s2">&quot;kp8&quot;</span><span class="p">,</span>
  <span class="mi">105</span><span class="o">:</span> <span class="s2">&quot;kp9&quot;</span><span class="p">,</span> <span class="mi">106</span><span class="o">:</span> <span class="s2">&quot;kp*&quot;</span><span class="p">,</span> <span class="mi">107</span><span class="o">:</span> <span class="s2">&quot;kp+&quot;</span><span class="p">,</span> <span class="mi">109</span><span class="o">:</span> <span class="s2">&quot;kp-&quot;</span><span class="p">,</span> <span class="mi">110</span><span class="o">:</span> <span class="s2">&quot;kp.&quot;</span><span class="p">,</span> <span class="mi">111</span><span class="o">:</span> <span class="s2">&quot;kp/&quot;</span><span class="p">,</span> <span class="mi">112</span><span class="o">:</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span>
  <span class="mi">113</span><span class="o">:</span> <span class="s2">&quot;f2&quot;</span><span class="p">,</span> <span class="mi">114</span><span class="o">:</span> <span class="s2">&quot;f3&quot;</span><span class="p">,</span> <span class="mi">115</span><span class="o">:</span> <span class="s2">&quot;f4&quot;</span><span class="p">,</span> <span class="mi">116</span><span class="o">:</span> <span class="s2">&quot;f5&quot;</span><span class="p">,</span> <span class="mi">117</span><span class="o">:</span> <span class="s2">&quot;f6&quot;</span><span class="p">,</span> <span class="mi">118</span><span class="o">:</span> <span class="s2">&quot;f7&quot;</span><span class="p">,</span> <span class="mi">119</span><span class="o">:</span> <span class="s2">&quot;f8&quot;</span><span class="p">,</span> <span class="mi">120</span><span class="o">:</span> <span class="s2">&quot;f9&quot;</span><span class="p">,</span>
  <span class="mi">121</span><span class="o">:</span> <span class="s2">&quot;f10&quot;</span><span class="p">,</span> <span class="mi">122</span><span class="o">:</span> <span class="s2">&quot;f11&quot;</span><span class="p">,</span> <span class="mi">123</span><span class="o">:</span> <span class="s2">&quot;f12&quot;</span><span class="p">,</span> <span class="mi">144</span><span class="o">:</span> <span class="s2">&quot;numlock&quot;</span><span class="p">,</span> <span class="mi">145</span><span class="o">:</span> <span class="s2">&quot;scrolllock&quot;</span><span class="p">,</span> <span class="mi">186</span><span class="o">:</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
  <span class="mi">187</span><span class="o">:</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="mi">188</span><span class="o">:</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="mi">189</span><span class="o">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">190</span><span class="o">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">191</span><span class="o">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">192</span><span class="o">:</span> <span class="s2">&quot;`&quot;</span><span class="p">,</span> <span class="mi">219</span><span class="o">:</span> <span class="s2">&quot;[&quot;</span><span class="p">,</span> <span class="mi">220</span><span class="o">:</span> <span class="s2">&quot;\\&quot;</span><span class="p">,</span>
  <span class="mi">221</span><span class="o">:</span> <span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="mi">222</span><span class="o">:</span> <span class="s2">&quot;&#39;&quot;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">shiftedKeys</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">192</span><span class="o">:</span><span class="s2">&quot;~&quot;</span><span class="p">,</span> <span class="mi">48</span><span class="o">:</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="mi">49</span><span class="o">:</span><span class="s2">&quot;!&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="o">:</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="mi">51</span><span class="o">:</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="mi">52</span><span class="o">:</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="mi">53</span><span class="o">:</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="mi">54</span><span class="o">:</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="mi">55</span><span class="o">:</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="mi">56</span><span class="o">:</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="mi">57</span><span class="o">:</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="mi">109</span><span class="o">:</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">61</span><span class="o">:</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
  <span class="mi">219</span><span class="o">:</span><span class="s2">&quot;{&quot;</span><span class="p">,</span> <span class="mi">221</span><span class="o">:</span><span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="mi">220</span><span class="o">:</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="mi">59</span><span class="o">:</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">222</span><span class="o">:</span><span class="s2">&quot;\&quot;&quot;</span><span class="p">,</span> <span class="mi">188</span><span class="o">:</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="mi">189</span><span class="o">:</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="mi">191</span><span class="o">:</span><span class="s2">&quot;?&quot;</span><span class="p">,</span>
  <span class="mi">96</span><span class="o">:</span><span class="s2">&quot;insert&quot;</span><span class="p">,</span> <span class="mi">97</span><span class="o">:</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="mi">98</span><span class="o">:</span><span class="s2">&quot;down&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="o">:</span><span class="s2">&quot;pagedown&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="o">:</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="mi">102</span><span class="o">:</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="mi">103</span><span class="o">:</span><span class="s2">&quot;home&quot;</span><span class="p">,</span> <span class="mi">104</span><span class="o">:</span><span class="s2">&quot;up&quot;</span><span class="p">,</span> <span class="mi">105</span><span class="o">:</span><span class="s2">&quot;pageup&quot;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">rightKeys</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">16</span><span class="o">:</span> <span class="s2">&quot;rshift&quot;</span><span class="p">,</span> <span class="mi">17</span><span class="o">:</span> <span class="s2">&quot;rctrl&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="o">:</span> <span class="s2">&quot;ralt&quot;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">getKeyFromEvent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">which</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">key</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyLocation</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">keyLocation</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">rightKeys</span><span class="p">[</span><span class="nx">code</span><span class="p">];</span> <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">shiftKey</span><span class="p">)</span> <span class="p">{</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">shiftedKeys</span><span class="p">[</span><span class="nx">code</span><span class="p">];</span> <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keys</span><span class="p">[</span><span class="nx">code</span><span class="p">];</span> <span class="p">}</span>

  <span class="k">return</span> <span class="nx">key</span> <span class="o">||</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">KeyboardProto</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">onPressed</span>  <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span> <span class="p">{},</span>
  <span class="nx">onReleased</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span> <span class="p">{},</span>
  <span class="nx">isDown</span>     <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">keysDown</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">Luv</span><span class="p">.</span><span class="nx">Keyboard</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">keyboard</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">KeyboardProto</span><span class="p">);</span>

  <span class="nx">keyboard</span><span class="p">.</span><span class="nx">keysDown</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="nx">el</span><span class="p">.</span><span class="nx">tabIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="nx">el</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>

  <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span>  <span class="o">=</span> <span class="nx">getKeyFromEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">keysDown</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onPressed</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">which</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;keyup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span>  <span class="o">=</span> <span class="nx">getKeyFromEvent</span><span class="p">(</span><span class="nx">evt</span><span class="p">);</span>
    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">keysDown</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">keyboard</span><span class="p">.</span><span class="nx">onReleased</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">evt</span><span class="p">.</span><span class="nx">which</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">keyboard</span><span class="p">;</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 